var settings={"domain":"http:\/\/onlinesequencer.net","template":"default","instruments":["Electric Piano","Acoustic Guitar","Percussion","Smooth Synth","Electric Guitar","Bass","Synth Pluck","Scifi","Grand Piano","French Horn","Trombone","Violin","Cello"],"min":[0,0,3,0,0,0,12,12,0,16,16,31,12],"max":[71,59,63,59,47,35,59,71,71,47,55,71,48],"offset":[0,0,0,0,0,0,11,12,0,0,0,0,0],"originalBpm":[30,15,10,30,30,30,30,30,15,30,30,40,40],"volume":[0.25,1,1,1,1,1,1,1,0.3,0.45,0.4,0.55,0.1],"altVolume":[0,0,0,0,0,0,0,0,0,0,0,0.85,0.2],"midiInstrumentMap":[1,25,1,81,30,33,88,100,1,61,58,41,43],"audioVersion":2,"typingKeyboard":["zxcvbnm,.\/","asdfghjkl;'","qwertyuiop[]"],"clipboardMagicString":"Online Sequencer","piano":["C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7"],"pianoNotes":["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],"scaleNames":["No Key Guide","C Major","C# Major","D Major","D# Major","E Major","F Major","F# Major","G Major","G# Major","A Major","A# Major","B Major","C Minor","C# Minor","D Minor","D# Minor","E Minor","F Minor","F# Minor","G Minor","G# Minor","A Minor","A# Minor","B Minor"],"scaleOctaves":[0,6,5,5,4,4,3,3,2,1,1,0,0,6,6,5,5,4,3,3,2,2,1,0,0],"scales":[[],["C","D","E","F","G","A","B","C","D","E","F","G"],["C#","D#","F","F#","G#","A#","C","C#","D#","F","F#","G#"],["D","E","F#","G","A","B","C#","D","E","F#","G","A"],["D#","F","G","G#","A#","C","D","D#","F","G","G#","A#"],["E","F#","G#","A","B","C#","D#","E","F#","G#","A","B"],["F","G","A","A#","C","D","E","F","G","A","A#","C"],["F#","G#","A#","B","C#","D#","F","F#","G#","A#","B","C#"],["G","A","B","C","D","E","F#","G","A","B","C","D"],["G#","A#","C","C#","D#","F","G","G#","A#","C","C#","D#"],["A","B","C#","D","E","F#","G#","A","B","C#","D","E"],["A#","C","D","D#","F","G","A","A#","C","D","D#","F"],["B","C#","D#","E","F#","G#","A#","B","C#","D#","E","F#"],["C","D","D#","F","G","G#","A#","C","D","D#","F","G"],["C#","D#","E","F#","G#","A","B","C#","D#","E","F#","G#"],["D","E","F","G","A","A#","C","D","E","F","G","A"],["D#","F","F#","G#","A#","B","C#","D#","F","F#","G#","A#"],["E","F#","G","A","B","C","D","E","F#","G","A","B"],["F","G","G#","A#","C","C#","D#","F","G","G#","A#","C"],["F#","G#","A","B","C#","D","E","F#","G#","A","B","C#"],["G","A","A#","C","D","D#","F","G","A","A#","C","D"],["G#","A#","B","C#","D#","E","F#","G#","A#","B","C#","D#"],["A","B","C","D","E","F","G","A","B","C","D","E"],["A#","C","C#","D#","F","F#","G#","A#","C","C#","D#","F"],["B","C#","D","E","F#","G","A","B","C#","D","E","F#"]],"percussion":["Open Surdo","Closed Surdo","Castanets","Belltree","Jingle Bell","Shaker","Open Triangle","Mute Triangle","Open Cuica","Mute Cuica","Low Woodblock","High Woodblock","Claves","Long Guiro","Short Guiro","Long Lo Whistle","Short Hi Whistle","Maracas","Cabasa","Low Agogo","High Agogo","Low Timbale","High Timbale","Low Conga","Open Hi Conga","Mute Hi Conga","Low Bongo","High Bongo","Ride Cymbal 2","Vibra-Slap","Crash Cymbal 2","Cowbell","Splash Cymbal","Tambourine","Ride Bell","Chinese Cymbal","Ride Cymbal","High Tom 1","Crash Cymbal","High Tom 2","Mid Tom 1","Open Hi-Hat","Mid Tom 2","Pedal Hi-Hat","Low Tom 1","Closed Hi-Hat","Low Tom 2","Snare Drum 2","Hand Clap","Snare Drum 1","Side Stick","Kick Drum 1","Kick Drum 2","Metronome Bell","Metronome Click","Square Click","Sticks","Scratch Pull","Scratch Push","Slap","High Q"],"username":null,"uid":0,"logoutkey":null,"numNotes":72,"numInstruments":13};(function(e,t,n){function s(t,n){this.bodyOverflowX;this.callbacks={hide:[],show:[]};this.checkInterval=null;this.Content;this.$el=e(t);this.$elProxy;this.elProxyPosition;this.enabled=true;this.options=e.extend({},i,n);this.mouseIsOverProxy=false;this.namespace="tooltipster-"+Math.round(Math.random()*1e5);this.Status="hidden";this.timerHide=null;this.timerShow=null;this.$tooltip;this.options.iconTheme=this.options.iconTheme.replace(".","");this.options.theme=this.options.theme.replace(".","");this._init()}function o(t,n){var r=true;e.each(t,function(e,i){if(typeof n[e]==="undefined"||t[e]!==n[e]){r=false;return false}});return r}function f(){return!a&&u}function l(){var e=n.body||n.documentElement,t=e.style,r="transition";if(typeof t[r]=="string"){return true}v=["Moz","Webkit","Khtml","O","ms"],r=r.charAt(0).toUpperCase()+r.substr(1);for(var i=0;i<v.length;i++){if(typeof t[v[i]+r]=="string"){return true}}return false}var r="tooltipster",i={animation:"fade",arrow:true,arrowColor:"",autoClose:true,content:null,contentAsHTML:false,contentCloning:true,debug:true,delay:200,minWidth:0,maxWidth:null,functionInit:function(e,t){},functionBefore:function(e,t){t()},functionReady:function(e,t){},functionAfter:function(e){},hideOnClick:false,icon:"(?)",iconCloning:true,iconDesktop:false,iconTouch:false,iconTheme:"tooltipster-icon",interactive:false,interactiveTolerance:350,multiple:false,offsetX:0,offsetY:0,onlyOne:false,position:"top",positionTracker:false,positionTrackerCallback:function(e){if(this.option("trigger")=="hover"&&this.option("autoClose")){this.hide()}},restoration:"current",speed:350,timer:0,theme:"tooltipster-default",touchDevices:true,trigger:"hover",updateAnimation:true};s.prototype={_init:function(){var t=this;if(n.querySelector){var r=null;if(t.$el.data("tooltipster-initialTitle")===undefined){r=t.$el.attr("title");if(r===undefined)r=null;t.$el.data("tooltipster-initialTitle",r)}if(t.options.content!==null){t._content_set(t.options.content)}else{t._content_set(r)}var i=t.options.functionInit.call(t.$el,t.$el,t.Content);if(typeof i!=="undefined")t._content_set(i);t.$el.removeAttr("title").addClass("tooltipstered");if(!u&&t.options.iconDesktop||u&&t.options.iconTouch){if(typeof t.options.icon==="string"){t.$elProxy=e('<span class="'+t.options.iconTheme+'"></span>');t.$elProxy.text(t.options.icon)}else{if(t.options.iconCloning)t.$elProxy=t.options.icon.clone(true);else t.$elProxy=t.options.icon}t.$elProxy.insertAfter(t.$el)}else{t.$elProxy=t.$el}if(t.options.trigger=="hover"){t.$elProxy.on("mouseenter."+t.namespace,function(){if(!f()||t.options.touchDevices){t.mouseIsOverProxy=true;t._show()}}).on("mouseleave."+t.namespace,function(){if(!f()||t.options.touchDevices){t.mouseIsOverProxy=false}});if(u&&t.options.touchDevices){t.$elProxy.on("touchstart."+t.namespace,function(){t._showNow()})}}else if(t.options.trigger=="click"){t.$elProxy.on("click."+t.namespace,function(){if(!f()||t.options.touchDevices){t._show()}})}}},_show:function(){var e=this;if(e.Status!="shown"&&e.Status!="appearing"){if(e.options.delay){e.timerShow=setTimeout(function(){if(e.options.trigger=="click"||e.options.trigger=="hover"&&e.mouseIsOverProxy){e._showNow()}},e.options.delay)}else e._showNow()}},_showNow:function(n){var r=this;r.options.functionBefore.call(r.$el,r.$el,function(){if(r.enabled&&r.Content!==null){if(n)r.callbacks.show.push(n);r.callbacks.hide=[];clearTimeout(r.timerShow);r.timerShow=null;clearTimeout(r.timerHide);r.timerHide=null;if(r.options.onlyOne){e(".tooltipstered").not(r.$el).each(function(t,n){var r=e(n),i=r.data("tooltipster-ns");e.each(i,function(e,t){var n=r.data(t),i=n.status(),s=n.option("autoClose");if(i!=="hidden"&&i!=="disappearing"&&s){n.hide()}})})}var i=function(){r.Status="shown";e.each(r.callbacks.show,function(e,t){t.call(r.$el)});r.callbacks.show=[]};if(r.Status!=="hidden"){var s=0;if(r.Status==="disappearing"){r.Status="appearing";if(l()){r.$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-"+r.options.animation+"-show");if(r.options.speed>0)r.$tooltip.delay(r.options.speed);r.$tooltip.queue(i)}else{r.$tooltip.stop().fadeIn(i)}}else if(r.Status==="shown"){i()}}else{r.Status="appearing";var s=r.options.speed;r.bodyOverflowX=e("body").css("overflow-x");e("body").css("overflow-x","hidden");var o="tooltipster-"+r.options.animation,a="-webkit-transition-duration: "+r.options.speed+"ms; -webkit-animation-duration: "+r.options.speed+"ms; -moz-transition-duration: "+r.options.speed+"ms; -moz-animation-duration: "+r.options.speed+"ms; -o-transition-duration: "+r.options.speed+"ms; -o-animation-duration: "+r.options.speed+"ms; -ms-transition-duration: "+r.options.speed+"ms; -ms-animation-duration: "+r.options.speed+"ms; transition-duration: "+r.options.speed+"ms; animation-duration: "+r.options.speed+"ms;",f=r.options.minWidth?"min-width:"+Math.round(r.options.minWidth)+"px;":"",c=r.options.maxWidth?"max-width:"+Math.round(r.options.maxWidth)+"px;":"",h=r.options.interactive?"pointer-events: auto;":"";r.$tooltip=e('<div class="tooltipster-base '+r.options.theme+'" style="'+f+" "+c+" "+h+" "+a+'"><div class="tooltipster-content"></div></div>');if(l())r.$tooltip.addClass(o);r._content_insert();r.$tooltip.appendTo("body");r.reposition();r.options.functionReady.call(r.$el,r.$el,r.$tooltip);if(l()){r.$tooltip.addClass(o+"-show");if(r.options.speed>0)r.$tooltip.delay(r.options.speed);r.$tooltip.queue(i)}else{r.$tooltip.css("display","none").fadeIn(r.options.speed,i)}r._interval_set();e(t).on("scroll."+r.namespace+" resize."+r.namespace,function(){r.reposition()});if(r.options.autoClose){e("body").off("."+r.namespace);if(r.options.trigger=="hover"){if(u){setTimeout(function(){e("body").on("touchstart."+r.namespace,function(){r.hide()})},0)}if(r.options.interactive){if(u){r.$tooltip.on("touchstart."+r.namespace,function(e){e.stopPropagation()})}var p=null;r.$elProxy.add(r.$tooltip).on("mouseleave."+r.namespace+"-autoClose",function(){clearTimeout(p);p=setTimeout(function(){r.hide()},r.options.interactiveTolerance)}).on("mouseenter."+r.namespace+"-autoClose",function(){clearTimeout(p)})}else{r.$elProxy.on("mouseleave."+r.namespace+"-autoClose",function(){r.hide()})}if(r.options.hideOnClick){r.$elProxy.on("click."+r.namespace+"-autoClose",function(){r.hide()})}}else if(r.options.trigger=="click"){setTimeout(function(){e("body").on("click."+r.namespace+" touchstart."+r.namespace,function(){r.hide()})},0);if(r.options.interactive){r.$tooltip.on("click."+r.namespace+" touchstart."+r.namespace,function(e){e.stopPropagation()})}}}}if(r.options.timer>0){r.timerHide=setTimeout(function(){r.timerHide=null;r.hide()},r.options.timer+s)}}})},_interval_set:function(){var t=this;t.checkInterval=setInterval(function(){if(e("body").find(t.$el).length===0||e("body").find(t.$elProxy).length===0||t.Status=="hidden"||e("body").find(t.$tooltip).length===0){if(t.Status=="shown"||t.Status=="appearing")t.hide();t._interval_cancel()}else{if(t.options.positionTracker){var n=t._repositionInfo(t.$elProxy),r=false;if(o(n.dimension,t.elProxyPosition.dimension)){if(t.$elProxy.css("position")==="fixed"){if(o(n.position,t.elProxyPosition.position))r=true}else{if(o(n.offset,t.elProxyPosition.offset))r=true}}if(!r){t.reposition();t.options.positionTrackerCallback.call(t,t.$el)}}}},200)},_interval_cancel:function(){clearInterval(this.checkInterval);this.checkInterval=null},_content_set:function(e){if(typeof e==="object"&&e!==null&&this.options.contentCloning){e=e.clone(true)}this.Content=e},_content_insert:function(){var e=this,t=this.$tooltip.find(".tooltipster-content");if(typeof e.Content==="string"&&!e.options.contentAsHTML){t.text(e.Content)}else{t.empty().append(e.Content)}},_update:function(e){var t=this;t._content_set(e);if(t.Content!==null){if(t.Status!=="hidden"){t._content_insert();t.reposition();if(t.options.updateAnimation){if(l()){t.$tooltip.css({width:"","-webkit-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-moz-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-o-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-ms-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms",transition:"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms"}).addClass("tooltipster-content-changing");setTimeout(function(){if(t.Status!="hidden"){t.$tooltip.removeClass("tooltipster-content-changing");setTimeout(function(){if(t.Status!=="hidden"){t.$tooltip.css({"-webkit-transition":t.options.speed+"ms","-moz-transition":t.options.speed+"ms","-o-transition":t.options.speed+"ms","-ms-transition":t.options.speed+"ms",transition:t.options.speed+"ms"})}},t.options.speed)}},t.options.speed)}else{t.$tooltip.fadeTo(t.options.speed,.5,function(){if(t.Status!="hidden"){t.$tooltip.fadeTo(t.options.speed,1)}})}}}}else{t.hide()}},_repositionInfo:function(e){return{dimension:{height:e.outerHeight(false),width:e.outerWidth(false)},offset:e.offset(),position:{left:parseInt(e.css("left")),top:parseInt(e.css("top"))}}},hide:function(n){var r=this;if(n)r.callbacks.hide.push(n);r.callbacks.show=[];clearTimeout(r.timerShow);r.timerShow=null;clearTimeout(r.timerHide);r.timerHide=null;var i=function(){e.each(r.callbacks.hide,function(e,t){t.call(r.$el)});r.callbacks.hide=[]};if(r.Status=="shown"||r.Status=="appearing"){r.Status="disappearing";var s=function(){r.Status="hidden";if(typeof r.Content=="object"&&r.Content!==null){r.Content.detach()}r.$tooltip.remove();r.$tooltip=null;e(t).off("."+r.namespace);e("body").off("."+r.namespace).css("overflow-x",r.bodyOverflowX);e("body").off("."+r.namespace);r.$elProxy.off("."+r.namespace+"-autoClose");r.options.functionAfter.call(r.$el,r.$el);i()};if(l()){r.$tooltip.clearQueue().removeClass("tooltipster-"+r.options.animation+"-show").addClass("tooltipster-dying");if(r.options.speed>0)r.$tooltip.delay(r.options.speed);r.$tooltip.queue(s)}else{r.$tooltip.stop().fadeOut(r.options.speed,s)}}else if(r.Status=="hidden"){i()}return r},show:function(e){this._showNow(e);return this},update:function(e){return this.content(e)},content:function(e){if(typeof e==="undefined"){return this.Content}else{this._update(e);return this}},reposition:function(){var n=this;if(e("body").find(n.$tooltip).length!==0){n.$tooltip.css("width","");n.elProxyPosition=n._repositionInfo(n.$elProxy);var r=null,i=e(t).width(),s=n.elProxyPosition,o=n.$tooltip.outerWidth(false),u=n.$tooltip.innerWidth()+1,a=n.$tooltip.outerHeight(false);if(n.$elProxy.is("area")){var f=n.$elProxy.attr("shape"),l=n.$elProxy.parent().attr("name"),c=e('img[usemap="#'+l+'"]'),h=c.offset().left,p=c.offset().top,d=n.$elProxy.attr("coords")!==undefined?n.$elProxy.attr("coords").split(","):undefined;if(f=="circle"){var v=parseInt(d[0]),m=parseInt(d[1]),g=parseInt(d[2]);s.dimension.height=g*2;s.dimension.width=g*2;s.offset.top=p+m-g;s.offset.left=h+v-g}else if(f=="rect"){var v=parseInt(d[0]),m=parseInt(d[1]),y=parseInt(d[2]),b=parseInt(d[3]);s.dimension.height=b-m;s.dimension.width=y-v;s.offset.top=p+m;s.offset.left=h+v}else if(f=="poly"){var w=[],E=[],S=0,x=0,T=0,N=0,C="even";for(var k=0;k<d.length;k++){var L=parseInt(d[k]);if(C=="even"){if(L>T){T=L;if(k===0){S=T}}if(L<S){S=L}C="odd"}else{if(L>N){N=L;if(k==1){x=N}}if(L<x){x=L}C="even"}}s.dimension.height=N-x;s.dimension.width=T-S;s.offset.top=p+x;s.offset.left=h+S}else{s.dimension.height=c.outerHeight(false);s.dimension.width=c.outerWidth(false);s.offset.top=p;s.offset.left=h}}var A=0,O=0,M=0,_=parseInt(n.options.offsetY),D=parseInt(n.options.offsetX),P=n.options.position;function H(){var n=e(t).scrollLeft();if(A-n<0){r=A-n;A=n}if(A+o-n>i){r=A-(i+n-o);A=i+n-o}}function B(n,r){if(s.offset.top-e(t).scrollTop()-a-_-12<0&&r.indexOf("top")>-1){P=n}if(s.offset.top+s.dimension.height+a+12+_>e(t).scrollTop()+e(t).height()&&r.indexOf("bottom")>-1){P=n;M=s.offset.top-a-_-12}}if(P=="top"){var j=s.offset.left+o-(s.offset.left+s.dimension.width);A=s.offset.left+D-j/2;M=s.offset.top-a-_-12;H();B("bottom","top")}if(P=="top-left"){A=s.offset.left+D;M=s.offset.top-a-_-12;H();B("bottom-left","top-left")}if(P=="top-right"){A=s.offset.left+s.dimension.width+D-o;M=s.offset.top-a-_-12;H();B("bottom-right","top-right")}if(P=="bottom"){var j=s.offset.left+o-(s.offset.left+s.dimension.width);A=s.offset.left-j/2+D;M=s.offset.top+s.dimension.height+_+12;H();B("top","bottom")}if(P=="bottom-left"){A=s.offset.left+D;M=s.offset.top+s.dimension.height+_+12;H();B("top-left","bottom-left")}if(P=="bottom-right"){A=s.offset.left+s.dimension.width+D-o;M=s.offset.top+s.dimension.height+_+12;H();B("top-right","bottom-right")}if(P=="left"){A=s.offset.left-D-o-12;O=s.offset.left+D+s.dimension.width+12;var F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_;if(A<0&&O+o>i){var I=parseFloat(n.$tooltip.css("border-width"))*2,q=o+A-I;n.$tooltip.css("width",q+"px");a=n.$tooltip.outerHeight(false);A=s.offset.left-D-q-12-I;F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_}else if(A<0){A=s.offset.left+D+s.dimension.width+12;r="left"}}if(P=="right"){A=s.offset.left+D+s.dimension.width+12;O=s.offset.left-D-o-12;var F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_;if(A+o>i&&O<0){var I=parseFloat(n.$tooltip.css("border-width"))*2,q=i-A-I;n.$tooltip.css("width",q+"px");a=n.$tooltip.outerHeight(false);F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_}else if(A+o>i){A=s.offset.left-D-o-12;r="right"}}if(n.options.arrow){var R="tooltipster-arrow-"+P;if(n.options.arrowColor.length<1){var U=n.$tooltip.css("background-color")}else{var U=n.options.arrowColor}if(!r){r=""}else if(r=="left"){R="tooltipster-arrow-right";r=""}else if(r=="right"){R="tooltipster-arrow-left";r=""}else{r="left:"+Math.round(r)+"px;"}if(P=="top"||P=="top-left"||P=="top-right"){var z=parseFloat(n.$tooltip.css("border-bottom-width")),W=n.$tooltip.css("border-bottom-color")}else if(P=="bottom"||P=="bottom-left"||P=="bottom-right"){var z=parseFloat(n.$tooltip.css("border-top-width")),W=n.$tooltip.css("border-top-color")}else if(P=="left"){var z=parseFloat(n.$tooltip.css("border-right-width")),W=n.$tooltip.css("border-right-color")}else if(P=="right"){var z=parseFloat(n.$tooltip.css("border-left-width")),W=n.$tooltip.css("border-left-color")}else{var z=parseFloat(n.$tooltip.css("border-bottom-width")),W=n.$tooltip.css("border-bottom-color")}if(z>1){z++}var X="";if(z!==0){var V="",J="border-color: "+W+";";if(R.indexOf("bottom")!==-1){V="margin-top: -"+Math.round(z)+"px;"}else if(R.indexOf("top")!==-1){V="margin-bottom: -"+Math.round(z)+"px;"}else if(R.indexOf("left")!==-1){V="margin-right: -"+Math.round(z)+"px;"}else if(R.indexOf("right")!==-1){V="margin-left: -"+Math.round(z)+"px;"}X='<span class="tooltipster-arrow-border" style="'+V+" "+J+';"></span>'}n.$tooltip.find(".tooltipster-arrow").remove();var K='<div class="'+R+' tooltipster-arrow" style="'+r+'">'+X+'<span style="border-color:'+U+';"></span></div>';n.$tooltip.append(K)}n.$tooltip.css({top:Math.round(M)+"px",left:Math.round(A)+"px"})}return n},enable:function(){this.enabled=true;return this},disable:function(){this.hide();this.enabled=false;return this},destroy:function(){var t=this;t.hide();if(t.$el[0]!==t.$elProxy[0]){t.$elProxy.remove()}t.$el.removeData(t.namespace).off("."+t.namespace);var n=t.$el.data("tooltipster-ns");if(n.length===1){var r=null;if(t.options.restoration==="previous"){r=t.$el.data("tooltipster-initialTitle")}else if(t.options.restoration==="current"){r=typeof t.Content==="string"?t.Content:e("<div></div>").append(t.Content).html()}if(r){t.$el.attr("title",r)}t.$el.removeClass("tooltipstered").removeData("tooltipster-ns").removeData("tooltipster-initialTitle")}else{n=e.grep(n,function(e,n){return e!==t.namespace});t.$el.data("tooltipster-ns",n)}return t},elementIcon:function(){return this.$el[0]!==this.$elProxy[0]?this.$elProxy[0]:undefined},elementTooltip:function(){return this.$tooltip?this.$tooltip[0]:undefined},option:function(e,t){if(typeof t=="undefined")return this.options[e];else{this.options[e]=t;return this}},status:function(){return this.Status}};e.fn[r]=function(){var t=arguments;if(this.length===0){if(typeof t[0]==="string"){var n=true;switch(t[0]){case"setDefaults":e.extend(i,t[1]);break;default:n=false;break}if(n)return true;else return this}else{return this}}else{if(typeof t[0]==="string"){var r="#*$~&";this.each(function(){var n=e(this).data("tooltipster-ns"),i=n?e(this).data(n[0]):null;if(i){if(typeof i[t[0]]==="function"){var s=i[t[0]](t[1],t[2])}else{throw new Error('Unknown method .tooltipster("'+t[0]+'")')}if(s!==i){r=s;return false}}else{throw new Error("You called Tooltipster's \""+t[0]+'" method on an uninitialized element')}});return r!=="#*$~&"?r:this}else{var o=[],u=t[0]&&typeof t[0].multiple!=="undefined",a=u&&t[0].multiple||!u&&i.multiple,f=t[0]&&typeof t[0].debug!=="undefined",l=f&&t[0].debug||!f&&i.debug;this.each(function(){var n=false,r=e(this).data("tooltipster-ns"),i=null;if(!r){n=true}else if(a){n=true}else if(l){console.log('Tooltipster: one or more tooltips are already attached to this element: ignoring. Use the "multiple" option to attach more tooltips.')}if(n){i=new s(this,t[0]);if(!r)r=[];r.push(i.namespace);e(this).data("tooltipster-ns",r);e(this).data(i.namespace,i)}o.push(i)});if(a)return o;else return this}}};var u=!!("ontouchstart"in t);var a=false;e("body").one("mousemove",function(){a=true})})(jQuery,window,document);
/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2009-2014 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.2.0
 */
!function(a,b){"use strict";var c,d,e,f=a,g=f.document,h=f.navigator,i=f.setTimeout,j=f.clearTimeout,k=f.setInterval,l=f.clearInterval,m=f.getComputedStyle,n=f.encodeURIComponent,o=f.ActiveXObject,p=f.Error,q=f.Number.parseInt||f.parseInt,r=f.Number.parseFloat||f.parseFloat,s=f.Number.isNaN||f.isNaN,t=f.Date.now,u=f.Object.keys,v=f.Object.defineProperty,w=f.Object.prototype.hasOwnProperty,x=f.Array.prototype.slice,y=function(){var a=function(a){return a};if("function"==typeof f.wrap&&"function"==typeof f.unwrap)try{var b=g.createElement("div"),c=f.unwrap(b);1===b.nodeType&&c&&1===c.nodeType&&(a=f.unwrap)}catch(d){}return a}(),z=function(a){return x.call(a,0)},A=function(){var a,c,d,e,f,g,h=z(arguments),i=h[0]||{};for(a=1,c=h.length;c>a;a++)if(null!=(d=h[a]))for(e in d)w.call(d,e)&&(f=i[e],g=d[e],i!==g&&g!==b&&(i[e]=g));return i},B=function(a){var b,c,d,e;if("object"!=typeof a||null==a||"number"==typeof a.nodeType)b=a;else if("number"==typeof a.length)for(b=[],c=0,d=a.length;d>c;c++)w.call(a,c)&&(b[c]=B(a[c]));else{b={};for(e in a)w.call(a,e)&&(b[e]=B(a[e]))}return b},C=function(a,b){for(var c={},d=0,e=b.length;e>d;d++)b[d]in a&&(c[b[d]]=a[b[d]]);return c},D=function(a,b){var c={};for(var d in a)-1===b.indexOf(d)&&(c[d]=a[d]);return c},E=function(a){if(a)for(var b in a)w.call(a,b)&&delete a[b];return a},F=function(a,b){if(a&&1===a.nodeType&&a.ownerDocument&&b&&(1===b.nodeType&&b.ownerDocument&&b.ownerDocument===a.ownerDocument||9===b.nodeType&&!b.ownerDocument&&b===a.ownerDocument))do{if(a===b)return!0;a=a.parentNode}while(a);return!1},G=function(a){var b;return"string"==typeof a&&a&&(b=a.split("#")[0].split("?")[0],b=a.slice(0,a.lastIndexOf("/")+1)),b},H=function(a){var b,c;return"string"==typeof a&&a&&(c=a.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]?b=c[1]:(c=a.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]&&(b=c[1]))),b},I=function(){var a,b;try{throw new p}catch(c){b=c}return b&&(a=b.sourceURL||b.fileName||H(b.stack)),a},J=function(){var a,c,d;if(g.currentScript&&(a=g.currentScript.src))return a;if(c=g.getElementsByTagName("script"),1===c.length)return c[0].src||b;if("readyState"in c[0])for(d=c.length;d--;)if("interactive"===c[d].readyState&&(a=c[d].src))return a;return"loading"===g.readyState&&(a=c[c.length-1].src)?a:(a=I())?a:b},K=function(){var a,c,d,e=g.getElementsByTagName("script");for(a=e.length;a--;){if(!(d=e[a].src)){c=null;break}if(d=G(d),null==c)c=d;else if(c!==d){c=null;break}}return c||b},L=function(){var a=G(J())||K()||"";return a+"ZeroClipboard.swf"},M=function(){return null==a.opener&&(!!a.top&&a!=a.top||!!a.parent&&a!=a.parent)}(),N={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null},O="11.0.0",P={},Q={},R=null,S=0,T=0,U={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}},V=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"],W=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"],X=new RegExp("^flash-("+W.map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),Y=new RegExp("^flash-("+W.slice(1).map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),Z={swfPath:L(),trustedDomains:a.location.host?[a.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},$=function(a){if("object"==typeof a&&null!==a)for(var b in a)if(w.call(a,b))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(b))Z[b]=a[b];else if(null==N.bridge)if("containerId"===b||"swfObjectId"===b){if(!nb(a[b]))throw new Error("The specified `"+b+"` value is not valid as an HTML4 Element ID");Z[b]=a[b]}else Z[b]=a[b];{if("string"!=typeof a||!a)return B(Z);if(w.call(Z,a))return Z[a]}},_=function(){return Tb(),{browser:C(h,["userAgent","platform","appName"]),flash:D(N,["bridge"]),zeroclipboard:{version:Vb.version,config:Vb.config()}}},ab=function(){return!!(N.disabled||N.outdated||N.sandboxed||N.unavailable||N.degraded||N.deactivated)},bb=function(a,d){var e,f,g,h={};if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&Vb.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,P[a]||(P[a]=[]),P[a].push(d);if(h.ready&&N.ready&&Vb.emit({type:"ready"}),h.error){for(e=0,f=W.length;f>e;e++)if(N[W[e].replace(/^flash-/,"")]===!0){Vb.emit({type:"error",name:W[e]});break}c!==b&&Vb.version!==c&&Vb.emit({type:"error",name:"version-mismatch",jsVersion:Vb.version,swfVersion:c})}}return Vb},cb=function(a,b){var c,d,e,f,g;if(0===arguments.length)f=u(P);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&Vb.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=P[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return Vb},db=function(a){var b;return b="string"==typeof a&&a?B(P[a])||null:B(P)},eb=function(a){var b,c,d;return a=ob(a),a&&!vb(a)?"ready"===a.type&&N.overdue===!0?Vb.emit({type:"error",name:"flash-overdue"}):(b=A({},a),tb.call(this,b),"copy"===a.type&&(d=Db(Q),c=d.data,R=d.formatMap),c):void 0},fb=function(){var a=N.sandboxed;if(Tb(),"boolean"!=typeof N.ready&&(N.ready=!1),N.sandboxed!==a&&N.sandboxed===!0)N.ready=!1,Vb.emit({type:"error",name:"flash-sandboxed"});else if(!Vb.isFlashUnusable()&&null===N.bridge){var b=Z.flashLoadTimeout;"number"==typeof b&&b>=0&&(S=i(function(){"boolean"!=typeof N.deactivated&&(N.deactivated=!0),N.deactivated===!0&&Vb.emit({type:"error",name:"flash-deactivated"})},b)),N.overdue=!1,Bb()}},gb=function(){Vb.clearData(),Vb.blur(),Vb.emit("destroy"),Cb(),Vb.off()},hb=function(a,b){var c;if("object"==typeof a&&a&&"undefined"==typeof b)c=a,Vb.clearData();else{if("string"!=typeof a||!a)return;c={},c[a]=b}for(var d in c)"string"==typeof d&&d&&w.call(c,d)&&"string"==typeof c[d]&&c[d]&&(Q[d]=c[d])},ib=function(a){"undefined"==typeof a?(E(Q),R=null):"string"==typeof a&&w.call(Q,a)&&delete Q[a]},jb=function(a){return"undefined"==typeof a?B(Q):"string"==typeof a&&w.call(Q,a)?Q[a]:void 0},kb=function(a){if(a&&1===a.nodeType){d&&(Lb(d,Z.activeClass),d!==a&&Lb(d,Z.hoverClass)),d=a,Kb(a,Z.hoverClass);var b=a.getAttribute("title")||Z.title;if("string"==typeof b&&b){var c=Ab(N.bridge);c&&c.setAttribute("title",b)}var e=Z.forceHandCursor===!0||"pointer"===Mb(a,"cursor");Rb(e),Qb()}},lb=function(){var a=Ab(N.bridge);a&&(a.removeAttribute("title"),a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px"),d&&(Lb(d,Z.hoverClass),Lb(d,Z.activeClass),d=null)},mb=function(){return d||null},nb=function(a){return"string"==typeof a&&a&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(a)},ob=function(a){var b;if("string"==typeof a&&a?(b=a,a={}):"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(b=a.type),b){b=b.toLowerCase(),!a.target&&(/^(copy|aftercopy|_click)$/.test(b)||"error"===b&&"clipboard-error"===a.name)&&(a.target=e),A(a,{type:b,target:a.target||d||null,relatedTarget:a.relatedTarget||null,currentTarget:N&&N.bridge||null,timeStamp:a.timeStamp||t()||null});var c=U[a.type];return"error"===a.type&&a.name&&c&&(c=c[a.name]),c&&(a.message=c),"ready"===a.type&&A(a,{target:null,version:N.version}),"error"===a.type&&(X.test(a.name)&&A(a,{target:null,minimumVersion:O}),Y.test(a.name)&&A(a,{version:N.version})),"copy"===a.type&&(a.clipboardData={setData:Vb.setData,clearData:Vb.clearData}),"aftercopy"===a.type&&(a=Eb(a,R)),a.target&&!a.relatedTarget&&(a.relatedTarget=pb(a.target)),qb(a)}},pb=function(a){var b=a&&a.getAttribute&&a.getAttribute("data-clipboard-target");return b?g.getElementById(b):null},qb=function(a){if(a&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)){var c=a.target,d="_mouseover"===a.type&&a.relatedTarget?a.relatedTarget:b,e="_mouseout"===a.type&&a.relatedTarget?a.relatedTarget:b,h=Nb(c),i=f.screenLeft||f.screenX||0,j=f.screenTop||f.screenY||0,k=g.body.scrollLeft+g.documentElement.scrollLeft,l=g.body.scrollTop+g.documentElement.scrollTop,m=h.left+("number"==typeof a._stageX?a._stageX:0),n=h.top+("number"==typeof a._stageY?a._stageY:0),o=m-k,p=n-l,q=i+o,r=j+p,s="number"==typeof a.movementX?a.movementX:0,t="number"==typeof a.movementY?a.movementY:0;delete a._stageX,delete a._stageY,A(a,{srcElement:c,fromElement:d,toElement:e,screenX:q,screenY:r,pageX:m,pageY:n,clientX:o,clientY:p,x:o,y:p,movementX:s,movementY:t,offsetX:0,offsetY:0,layerX:0,layerY:0})}return a},rb=function(a){var b=a&&"string"==typeof a.type&&a.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(b)},sb=function(a,b,c,d){d?i(function(){a.apply(b,c)},0):a.apply(b,c)},tb=function(a){if("object"==typeof a&&a&&a.type){var b=rb(a),c=P["*"]||[],d=P[a.type]||[],e=c.concat(d);if(e&&e.length){var g,h,i,j,k,l=this;for(g=0,h=e.length;h>g;g++)i=e[g],j=l,"string"==typeof i&&"function"==typeof f[i]&&(i=f[i]),"object"==typeof i&&i&&"function"==typeof i.handleEvent&&(j=i,i=i.handleEvent),"function"==typeof i&&(k=A({},a),sb(i,j,[k],b))}return this}},ub=function(a){var b=null;return(M===!1||a&&"error"===a.type&&a.name&&-1!==V.indexOf(a.name))&&(b=!1),b},vb=function(a){var b=a.target||d||null,f="swf"===a._source;switch(delete a._source,a.type){case"error":var g="flash-sandboxed"===a.name||ub(a);"boolean"==typeof g&&(N.sandboxed=g),-1!==W.indexOf(a.name)?A(N,{disabled:"flash-disabled"===a.name,outdated:"flash-outdated"===a.name,unavailable:"flash-unavailable"===a.name,degraded:"flash-degraded"===a.name,deactivated:"flash-deactivated"===a.name,overdue:"flash-overdue"===a.name,ready:!1}):"version-mismatch"===a.name&&(c=a.swfVersion,A(N,{disabled:!1,outdated:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1})),Pb();break;case"ready":c=a.swfVersion;var h=N.deactivated===!0;A(N,{disabled:!1,outdated:!1,sandboxed:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:h,ready:!h}),Pb();break;case"beforecopy":e=b;break;case"copy":var i,j,k=a.relatedTarget;!Q["text/html"]&&!Q["text/plain"]&&k&&(j=k.value||k.outerHTML||k.innerHTML)&&(i=k.value||k.textContent||k.innerText)?(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i),j!==i&&a.clipboardData.setData("text/html",j)):!Q["text/plain"]&&a.target&&(i=a.target.getAttribute("data-clipboard-text"))&&(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i));break;case"aftercopy":wb(a),Vb.clearData(),b&&b!==Jb()&&b.focus&&b.focus();break;case"_mouseover":Vb.focus(b),Z.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&xb(A({},a,{type:"mouseenter",bubbles:!1,cancelable:!1})),xb(A({},a,{type:"mouseover"})));break;case"_mouseout":Vb.blur(),Z.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&xb(A({},a,{type:"mouseleave",bubbles:!1,cancelable:!1})),xb(A({},a,{type:"mouseout"})));break;case"_mousedown":Kb(b,Z.activeClass),Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}));break;case"_mouseup":Lb(b,Z.activeClass),Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}));break;case"_click":e=null,Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}));break;case"_mousemove":Z.bubbleEvents===!0&&f&&xb(A({},a,{type:a.type.slice(1)}))}return/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)?!0:void 0},wb=function(a){if(a.errors&&a.errors.length>0){var b=B(a);A(b,{type:"error",name:"clipboard-error"}),delete b.success,i(function(){Vb.emit(b)},0)}},xb=function(a){if(a&&"string"==typeof a.type&&a){var b,c=a.target||null,d=c&&c.ownerDocument||g,e={view:d.defaultView||f,canBubble:!0,cancelable:!0,detail:"click"===a.type?1:0,button:"number"==typeof a.which?a.which-1:"number"==typeof a.button?a.button:d.createEvent?0:1},h=A(e,a);c&&d.createEvent&&c.dispatchEvent&&(h=[h.type,h.canBubble,h.cancelable,h.view,h.detail,h.screenX,h.screenY,h.clientX,h.clientY,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.button,h.relatedTarget],b=d.createEvent("MouseEvents"),b.initMouseEvent&&(b.initMouseEvent.apply(b,h),b._source="js",c.dispatchEvent(b)))}},yb=function(){var a=Z.flashLoadTimeout;if("number"==typeof a&&a>=0){var b=Math.min(1e3,a/10),c=Z.swfObjectId+"_fallbackContent";T=k(function(){var a=g.getElementById(c);Ob(a)&&(Pb(),N.deactivated=null,Vb.emit({type:"error",name:"swf-not-found"}))},b)}},zb=function(){var a=g.createElement("div");return a.id=Z.containerId,a.className=Z.containerClass,a.style.position="absolute",a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px",a.style.zIndex=""+Sb(Z.zIndex),a},Ab=function(a){for(var b=a&&a.parentNode;b&&"OBJECT"===b.nodeName&&b.parentNode;)b=b.parentNode;return b||null},Bb=function(){var a,b=N.bridge,c=Ab(b);if(!b){var d=Ib(f.location.host,Z),e="never"===d?"none":"all",h=Gb(A({jsVersion:Vb.version},Z)),i=Z.swfPath+Fb(Z.swfPath,Z);c=zb();var j=g.createElement("div");c.appendChild(j),g.body.appendChild(c);var k=g.createElement("div"),l="activex"===N.pluginType;k.innerHTML='<object id="'+Z.swfObjectId+'" name="'+Z.swfObjectId+'" width="100%" height="100%" '+(l?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+i+'"')+">"+(l?'<param name="movie" value="'+i+'"/>':"")+'<param name="allowScriptAccess" value="'+d+'"/><param name="allowNetworking" value="'+e+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+h+'"/><div id="'+Z.swfObjectId+'_fallbackContent">&nbsp;</div></object>',b=k.firstChild,k=null,y(b).ZeroClipboard=Vb,c.replaceChild(b,j),yb()}return b||(b=g[Z.swfObjectId],b&&(a=b.length)&&(b=b[a-1]),!b&&c&&(b=c.firstChild)),N.bridge=b||null,b},Cb=function(){var a=N.bridge;if(a){var d=Ab(a);d&&("activex"===N.pluginType&&"readyState"in a?(a.style.display="none",function e(){if(4===a.readyState){for(var b in a)"function"==typeof a[b]&&(a[b]=null);a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d)}else i(e,10)}()):(a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d))),Pb(),N.ready=null,N.bridge=null,N.deactivated=null,c=b}},Db=function(a){var b={},c={};if("object"==typeof a&&a){for(var d in a)if(d&&w.call(a,d)&&"string"==typeof a[d]&&a[d])switch(d.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":b.text=a[d],c.text=d;break;case"text/html":case"html":case"air:html":case"flash:html":b.html=a[d],c.html=d;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":b.rtf=a[d],c.rtf=d}return{data:b,formatMap:c}}},Eb=function(a,b){if("object"!=typeof a||!a||"object"!=typeof b||!b)return a;var c={};for(var d in a)if(w.call(a,d))if("errors"===d){c[d]=a[d]?a[d].slice():[];for(var e=0,f=c[d].length;f>e;e++)c[d][e].format=b[c[d][e].format]}else if("success"!==d&&"data"!==d)c[d]=a[d];else{c[d]={};var g=a[d];for(var h in g)h&&w.call(g,h)&&w.call(b,h)&&(c[d][b[h]]=g[h])}return c},Fb=function(a,b){var c=null==b||b&&b.cacheBust===!0;return c?(-1===a.indexOf("?")?"?":"&")+"noCache="+t():""},Gb=function(a){var b,c,d,e,g="",h=[];if(a.trustedDomains&&("string"==typeof a.trustedDomains?e=[a.trustedDomains]:"object"==typeof a.trustedDomains&&"length"in a.trustedDomains&&(e=a.trustedDomains)),e&&e.length)for(b=0,c=e.length;c>b;b++)if(w.call(e,b)&&e[b]&&"string"==typeof e[b]){if(d=Hb(e[b]),!d)continue;if("*"===d){h.length=0,h.push(d);break}h.push.apply(h,[d,"//"+d,f.location.protocol+"//"+d])}return h.length&&(g+="trustedOrigins="+n(h.join(","))),a.forceEnhancedClipboard===!0&&(g+=(g?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof a.swfObjectId&&a.swfObjectId&&(g+=(g?"&":"")+"swfObjectId="+n(a.swfObjectId)),"string"==typeof a.jsVersion&&a.jsVersion&&(g+=(g?"&":"")+"jsVersion="+n(a.jsVersion)),g},Hb=function(a){if(null==a||""===a)return null;if(a=a.replace(/^\s+|\s+$/g,""),""===a)return null;var b=a.indexOf("//");a=-1===b?a:a.slice(b+2);var c=a.indexOf("/");return a=-1===c?a:-1===b||0===c?null:a.slice(0,c),a&&".swf"===a.slice(-4).toLowerCase()?null:a||null},Ib=function(){var a=function(a){var b,c,d,e=[];if("string"==typeof a&&(a=[a]),"object"!=typeof a||!a||"number"!=typeof a.length)return e;for(b=0,c=a.length;c>b;b++)if(w.call(a,b)&&(d=Hb(a[b]))){if("*"===d){e.length=0,e.push("*");break}-1===e.indexOf(d)&&e.push(d)}return e};return function(b,c){var d=Hb(c.swfPath);null===d&&(d=b);var e=a(c.trustedDomains),f=e.length;if(f>0){if(1===f&&"*"===e[0])return"always";if(-1!==e.indexOf(b))return 1===f&&b===d?"sameDomain":"always"}return"never"}}(),Jb=function(){try{return g.activeElement}catch(a){return null}},Kb=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0)if(a.classList)for(c=0,d=f.length;d>c;c++)a.classList.add(f[c]);else if(a.hasOwnProperty("className")){for(e=" "+a.className+" ",c=0,d=f.length;d>c;c++)-1===e.indexOf(" "+f[c]+" ")&&(e+=f[c]+" ");a.className=e.replace(/^\s+|\s+$/g,"")}return a},Lb=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0)if(a.classList&&a.classList.length>0)for(c=0,d=f.length;d>c;c++)a.classList.remove(f[c]);else if(a.className){for(e=(" "+a.className+" ").replace(/[\r\n\t]/g," "),c=0,d=f.length;d>c;c++)e=e.replace(" "+f[c]+" "," ");a.className=e.replace(/^\s+|\s+$/g,"")}return a},Mb=function(a,b){var c=m(a,null).getPropertyValue(b);return"cursor"!==b||c&&"auto"!==c||"A"!==a.nodeName?c:"pointer"},Nb=function(a){var b={left:0,top:0,width:0,height:0};if(a.getBoundingClientRect){var c=a.getBoundingClientRect(),d=f.pageXOffset,e=f.pageYOffset,h=g.documentElement.clientLeft||0,i=g.documentElement.clientTop||0,j=0,k=0;if("relative"===Mb(g.body,"position")){var l=g.body.getBoundingClientRect(),m=g.documentElement.getBoundingClientRect();j=l.left-m.left||0,k=l.top-m.top||0}b.left=c.left+d-h-j,b.top=c.top+e-i-k,b.width="width"in c?c.width:c.right-c.left,b.height="height"in c?c.height:c.bottom-c.top}return b},Ob=function(a){if(!a)return!1;var b=m(a,null),c=r(b.height)>0,d=r(b.width)>0,e=r(b.top)>=0,f=r(b.left)>=0,g=c&&d&&e&&f,h=g?null:Nb(a),i="none"!==b.display&&"collapse"!==b.visibility&&(g||!!h&&(c||h.height>0)&&(d||h.width>0)&&(e||h.top>=0)&&(f||h.left>=0));return i},Pb=function(){j(S),S=0,l(T),T=0},Qb=function(){var a;if(d&&(a=Ab(N.bridge))){var b=Nb(d);A(a.style,{width:b.width+"px",height:b.height+"px",top:b.top+"px",left:b.left+"px",zIndex:""+Sb(Z.zIndex)})}},Rb=function(a){N.ready===!0&&(N.bridge&&"function"==typeof N.bridge.setHandCursor?N.bridge.setHandCursor(a):N.ready=!1)},Sb=function(a){if(/^(?:auto|inherit)$/.test(a))return a;var b;return"number"!=typeof a||s(a)?"string"==typeof a&&(b=Sb(q(a,10))):b=a,"number"==typeof b?b:"auto"},Tb=function(b){var c,d,e,f=N.sandboxed,g=null;if(b=b===!0,M===!1)g=!1;else{try{d=a.frameElement||null}catch(h){e={name:h.name,message:h.message}}if(d&&1===d.nodeType&&"IFRAME"===d.nodeName)try{g=d.hasAttribute("sandbox")}catch(h){g=null}else{try{c=document.domain||null}catch(h){c=null}(null===c||e&&"SecurityError"===e.name&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(e.message.toLowerCase()))&&(g=!0)}}return N.sandboxed=g,f===g||b||Ub(o),g},Ub=function(a){function b(a){var b=a.match(/[\d]+/g);return b.length=3,b.join(".")}function c(a){return!!a&&(a=a.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(a)||"chrome.plugin"===a.slice(-13))}function d(a){a&&(i=!0,a.version&&(l=b(a.version)),!l&&a.description&&(l=b(a.description)),a.filename&&(k=c(a.filename)))}var e,f,g,i=!1,j=!1,k=!1,l="";if(h.plugins&&h.plugins.length)e=h.plugins["Shockwave Flash"],d(e),h.plugins["Shockwave Flash 2.0"]&&(i=!0,l="2.0.0.11");else if(h.mimeTypes&&h.mimeTypes.length)g=h.mimeTypes["application/x-shockwave-flash"],e=g&&g.enabledPlugin,d(e);else if("undefined"!=typeof a){j=!0;try{f=new a("ShockwaveFlash.ShockwaveFlash.7"),i=!0,l=b(f.GetVariable("$version"))}catch(m){try{f=new a("ShockwaveFlash.ShockwaveFlash.6"),i=!0,l="6.0.21"}catch(n){try{f=new a("ShockwaveFlash.ShockwaveFlash"),i=!0,l=b(f.GetVariable("$version"))}catch(o){j=!1}}}}N.disabled=i!==!0,N.outdated=l&&r(l)<r(O),N.version=l||"0.0.0",N.pluginType=k?"pepper":j?"activex":i?"netscape":"unknown"};Ub(o),Tb(!0);var Vb=function(){return this instanceof Vb?void("function"==typeof Vb._createClient&&Vb._createClient.apply(this,z(arguments))):new Vb};v(Vb,"version",{value:"2.2.0",writable:!1,configurable:!0,enumerable:!0}),Vb.config=function(){return $.apply(this,z(arguments))},Vb.state=function(){return _.apply(this,z(arguments))},Vb.isFlashUnusable=function(){return ab.apply(this,z(arguments))},Vb.on=function(){return bb.apply(this,z(arguments))},Vb.off=function(){return cb.apply(this,z(arguments))},Vb.handlers=function(){return db.apply(this,z(arguments))},Vb.emit=function(){return eb.apply(this,z(arguments))},Vb.create=function(){return fb.apply(this,z(arguments))},Vb.destroy=function(){return gb.apply(this,z(arguments))},Vb.setData=function(){return hb.apply(this,z(arguments))},Vb.clearData=function(){return ib.apply(this,z(arguments))},Vb.getData=function(){return jb.apply(this,z(arguments))},Vb.focus=Vb.activate=function(){return kb.apply(this,z(arguments))},Vb.blur=Vb.deactivate=function(){return lb.apply(this,z(arguments))},Vb.activeElement=function(){return mb.apply(this,z(arguments))};var Wb=0,Xb={},Yb=0,Zb={},$b={};A(Z,{autoActivate:!0});var _b=function(a){var b=this;b.id=""+Wb++,Xb[b.id]={instance:b,elements:[],handlers:{}},a&&b.clip(a),Vb.on("*",function(a){return b.emit(a)}),Vb.on("destroy",function(){b.destroy()}),Vb.create()},ac=function(a,d){var e,f,g,h={},i=Xb[this.id],j=i&&i.handlers;if(!i)throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&this.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,j[a]||(j[a]=[]),j[a].push(d);if(h.ready&&N.ready&&this.emit({type:"ready",client:this}),h.error){for(e=0,f=W.length;f>e;e++)if(N[W[e].replace(/^flash-/,"")]){this.emit({type:"error",name:W[e],client:this});break}c!==b&&Vb.version!==c&&this.emit({type:"error",name:"version-mismatch",jsVersion:Vb.version,swfVersion:c})}}return this},bc=function(a,b){var c,d,e,f,g,h=Xb[this.id],i=h&&h.handlers;if(!i)return this;if(0===arguments.length)f=u(i);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&this.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=i[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return this},cc=function(a){var b=null,c=Xb[this.id]&&Xb[this.id].handlers;return c&&(b="string"==typeof a&&a?c[a]?c[a].slice(0):[]:B(c)),b},dc=function(a){if(ic.call(this,a)){"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(a=A({},a));var b=A({},ob(a),{client:this});jc.call(this,b)}return this},ec=function(a){if(!Xb[this.id])throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");a=kc(a);for(var b=0;b<a.length;b++)if(w.call(a,b)&&a[b]&&1===a[b].nodeType){a[b].zcClippingId?-1===Zb[a[b].zcClippingId].indexOf(this.id)&&Zb[a[b].zcClippingId].push(this.id):(a[b].zcClippingId="zcClippingId_"+Yb++,Zb[a[b].zcClippingId]=[this.id],Z.autoActivate===!0&&lc(a[b]));var c=Xb[this.id]&&Xb[this.id].elements;-1===c.indexOf(a[b])&&c.push(a[b])}return this},fc=function(a){var b=Xb[this.id];if(!b)return this;var c,d=b.elements;a="undefined"==typeof a?d.slice(0):kc(a);for(var e=a.length;e--;)if(w.call(a,e)&&a[e]&&1===a[e].nodeType){for(c=0;-1!==(c=d.indexOf(a[e],c));)d.splice(c,1);var f=Zb[a[e].zcClippingId];if(f){for(c=0;-1!==(c=f.indexOf(this.id,c));)f.splice(c,1);0===f.length&&(Z.autoActivate===!0&&mc(a[e]),delete a[e].zcClippingId)}}return this},gc=function(){var a=Xb[this.id];return a&&a.elements?a.elements.slice(0):[]},hc=function(){Xb[this.id]&&(this.unclip(),this.off(),delete Xb[this.id])},ic=function(a){if(!a||!a.type)return!1;if(a.client&&a.client!==this)return!1;var b=Xb[this.id],c=b&&b.elements,d=!!c&&c.length>0,e=!a.target||d&&-1!==c.indexOf(a.target),f=a.relatedTarget&&d&&-1!==c.indexOf(a.relatedTarget),g=a.client&&a.client===this;return b&&(e||f||g)?!0:!1},jc=function(a){var b=Xb[this.id];if("object"==typeof a&&a&&a.type&&b){var c=rb(a),d=b&&b.handlers["*"]||[],e=b&&b.handlers[a.type]||[],g=d.concat(e);if(g&&g.length){var h,i,j,k,l,m=this;for(h=0,i=g.length;i>h;h++)j=g[h],k=m,"string"==typeof j&&"function"==typeof f[j]&&(j=f[j]),"object"==typeof j&&j&&"function"==typeof j.handleEvent&&(k=j,j=j.handleEvent),"function"==typeof j&&(l=A({},a),sb(j,k,[l],c))}}},kc=function(a){return"string"==typeof a&&(a=[]),"number"!=typeof a.length?[a]:a},lc=function(a){if(a&&1===a.nodeType){var b=function(a){(a||(a=f.event))&&("js"!==a._source&&(a.stopImmediatePropagation(),a.preventDefault()),delete a._source)},c=function(c){(c||(c=f.event))&&(b(c),Vb.focus(a))};a.addEventListener("mouseover",c,!1),a.addEventListener("mouseout",b,!1),a.addEventListener("mouseenter",b,!1),a.addEventListener("mouseleave",b,!1),a.addEventListener("mousemove",b,!1),$b[a.zcClippingId]={mouseover:c,mouseout:b,mouseenter:b,mouseleave:b,mousemove:b}}},mc=function(a){if(a&&1===a.nodeType){var b=$b[a.zcClippingId];if("object"==typeof b&&b){for(var c,d,e=["move","leave","enter","out","over"],f=0,g=e.length;g>f;f++)c="mouse"+e[f],d=b[c],"function"==typeof d&&a.removeEventListener(c,d,!1);delete $b[a.zcClippingId]}}};Vb._createClient=function(){_b.apply(this,z(arguments))},Vb.prototype.on=function(){return ac.apply(this,z(arguments))},Vb.prototype.off=function(){return bc.apply(this,z(arguments))},Vb.prototype.handlers=function(){return cc.apply(this,z(arguments))},Vb.prototype.emit=function(){return dc.apply(this,z(arguments))},Vb.prototype.clip=function(){return ec.apply(this,z(arguments))},Vb.prototype.unclip=function(){return fc.apply(this,z(arguments))},Vb.prototype.elements=function(){return gc.apply(this,z(arguments))},Vb.prototype.destroy=function(){return hc.apply(this,z(arguments))},Vb.prototype.setText=function(a){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData("text/plain",a),this},Vb.prototype.setHtml=function(a){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData("text/html",a),this},Vb.prototype.setRichText=function(a){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData("application/rtf",a),this},Vb.prototype.setData=function(){if(!Xb[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.setData.apply(this,z(arguments)),this},Vb.prototype.clearData=function(){if(!Xb[this.id])throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.clearData.apply(this,z(arguments)),this},Vb.prototype.getData=function(){if(!Xb[this.id])throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");return Vb.getData.apply(this,z(arguments))},"function"==typeof define&&define.amd?define(function(){return Vb}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=Vb:a.ZeroClipboard=Vb}(function(){return this||window}());function doLogin(){var username=jQuery('#username').val();var password=jQuery('#password').val();jQuery.get('/ajax/login.php?user='+encodeURIComponent(username)+'&pass='+encodeURIComponent(password),function(data){var result=JSON.parse(data);if(result==false){alert('Incorrect username or password.');}else{jQuery.post('/forum/member.php','action=do_login&remember=yes&url='+encodeURIComponent(window.location.href)+'&username='+encodeURIComponent(username)+'&password='+encodeURIComponent(password),function(){settings['username']=result['username'];settings['uid']=parseInt(result['uid']);settings['logoutkey']=result['logoutkey'];jQuery('#member_username').html(result['username']);userMember.css('display','block');userGuest.css('display','none');});}});}
function submitOnEnter(e){if(e.which==13){doLogin();e.preventDefault();}}
function mainInit(){userGuest=jQuery('#user_guest');userMember=jQuery('#user_member');loginbutton=jQuery('#login_button');logoutbutton=jQuery('#member_logout');loginfields=jQuery('#login_fields');if(loginbutton){loginbutton.click(function(){if(loginfields.css('display')=="none"){loginfields.css('display','inline-block');return false;}else{doLogin();}
    return false;});}
    if(logoutbutton){logoutbutton.click(function(){jQuery.get('/forum/member.php?action=logout&logoutkey='+settings['logoutkey'],function(){settings['username']='';settings['uid']=0;settings['logoutkey']='';userMember.css('display','none');userGuest.css('display','block');});});}
    $('#username').keypress(submitOnEnter);$('#password').keypress(submitOnEnter);$('.btn, .active, #play_small, #audio_track_link').tooltipster({arrow:false,onlyOne:true,position:'bottom',delay:100,speed:100});$('.preview').tooltipster({arrow:true,onlyOne:true,position:'right',delay:100,speed:100});}
window.onload=mainInit;window.confirmExit=false;window.onbeforeunload=function(e)
{if(window.confirmExit){var msg="Are you sure you want to close this window? You will lose any unsaved changes.";if(!e){e=window.event;}
    if(e){e.returnValue=msg;}
    return msg;}}
function showExitWarning(){return confirm('Are you sure you want to close this window? You will lose any unsaved changes.');}
var sortType="random";function sort(type)
{if(sortType==type)
    return;else
{document.getElementById(sortType).style.display="none";document.getElementById(sortType+"_link").style.fontWeight="normal";sortType=type;document.getElementById(sortType).style.display="block";document.getElementById(sortType+"_link").style.fontWeight="bold";}}
function updateSidebar(){$.get('/ajax/random.php?id='+window.location.hash.substr(1),function(result){$('#sidebar_dynamic').html(result);mainInit();});sort('random');}
function setSequence(id){$('#loading_overlay').css('display','block');if(id==0&&window.location.pathname!='/')
    id=parseInt(window.location.pathname.substr(1));if(id!=0){$.get('/ajax/load.php?id='+id,function(result){var data=JSON.parse(result);loadData(data['data']);$('#loading_overlay').css('display','none');var playbutton=document.getElementById('playbutton');document.title='Online Sequencer / '+data['windowTitle'];$('#title').val(data['title']);playbutton.style.display="block";playbutton.onclick=function()
{playbutton.style.display="none";if(!loading){song.play(0);}
else{autoplay=true;}
    return false;}
    $('#nav_right').html(data['navRight']);});}else{loadData('');$('#nav_right').html('');document.title='Online Sequencer / Make music online';playbutton.style.display="none";$('#loading_overlay').css('display','none');}
    updateSidebar();}
function onSequenceLinkClick(event,id){var btn=getButton(event);if(btn==1){navigate(id);return false;}else{return true;}}
var settingHash=false;function navigate(id){if(!window.confirmExit||showExitWarning()){window.confirmExit=false;settingHash=true;window.location.hash=id==0?'':id;setSequence(id);$('#stats').html("<sc"+"ript type='text/javascript' src='"+scJsHost+"statcounter.com/counter/counter.js'></"+"script>");}}
window.onhashchange=function(){if(settingHash){settingHash=false;}
else{navigate(window.location.hash==""?0:parseInt(window.location.hash.substring(1)));settingHash=false;}}
if(window.location.hash!=''&&!isNaN(window.location.hash.substr(1)))
    window.location=('/'+parseInt(window.location.hash.substring(1)));function showChat()
{document.getElementById("chatplaceholder").innerHTML='<div id="chatbox"><div id="chatbox_inner"><div id="chatbox_left"></div><div id="chatbox_right"><a href="/logs?page=last" target="_blank">Chat Logs</a> &middot; <a href="javascript:hideChat()">Close</a></div><iframe allowTransparency="true" scrolling="no" src="/forum/chat_frame.php" frameborder="0"></iframe></div></div>';}
function hideChat()
{document.getElementById("chatplaceholder").innerHTML='';}"use strict";var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,renderer:"Canvas",backend:"WebAudio",mediaType:"audio"},init:function(t){if(this.params=WaveSurfer.util.extend({},this.defaultParams,t),this.container="string"==typeof t.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(this.mediaContainer="undefined"==typeof this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.createDrawer(),this.createBackend()},createDrawer:function(){var t=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){t.drawBuffer(),t.drawer.progress(t.backend.getPlayedPercents())}),this.drawer.on("click",function(e,i){setTimeout(function(){t.seekTo(i)},0)}),this.drawer.on("scroll",function(e){t.fireEvent("scroll",e)})},createBackend:function(){var t=this;this.backend&&this.backend.destroy(),"WebAudio"!=this.params.backend||WaveSurfer.WebAudio.supportsWebAudio()||(this.params.backend="AudioElement"),this.backend=Object.create(WaveSurfer[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){t.fireEvent("finish")}),this.backend.on("audioprocess",function(e){t.fireEvent("audioprocess",e)})},restartAnimationLoop:function(){var t=this,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=function(){t.backend.isPaused()||(t.drawer.progress(t.backend.getPlayedPercents()),e(i))};i()},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(t,e){this.backend.play(t,e),this.restartAnimationLoop(),this.fireEvent("play")},pause:function(){this.backend.pause(),this.fireEvent("pause")},playPause:function(){this.backend.isPaused()?this.play():this.pause()},skipBackward:function(t){this.skip(-t||-this.params.skipLength)},skipForward:function(t){this.skip(t||this.params.skipLength)},skip:function(t){var e=this.getCurrentTime()||0,i=this.getDuration()||1;e=Math.max(0,Math.min(i,e+(t||0))),this.seekAndCenter(e/i)},seekAndCenter:function(t){this.seekTo(t),this.drawer.recenter(t)},seekTo:function(t){var e=this.backend.isPaused(),i=this.params.scrollParent;e&&(this.params.scrollParent=!1),this.backend.seekTo(t*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),e||(this.backend.pause(),this.backend.play()),this.params.scrollParent=i,this.fireEvent("seek",t)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(t){this.backend.setVolume(t)},setPlaybackRate:function(t){this.backend.setPlaybackRate(t)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),e=this.drawer.getWidth(),i=t;this.params.fillParent&&(!this.params.scrollParent||e>t)&&(i=e);var r=this.backend.getPeaks(i);this.drawer.drawPeaks(r,i),this.fireEvent("redraw",r,i)},loadArrayBuffer:function(t){var e=this;this.backend.decodeArrayBuffer(t,function(t){e.loadDecodedBuffer(t)},function(){e.fireEvent("error","Error decoding audiobuffer")})},loadDecodedBuffer:function(t){this.empty(),this.backend.load(t),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(t){var e=this,i=new FileReader;i.addEventListener("progress",function(t){e.onProgress(t)}),i.addEventListener("load",function(t){e.empty(),e.loadArrayBuffer(t.target.result)}),i.addEventListener("error",function(){e.fireEvent("error","Error reading file")}),i.readAsArrayBuffer(t)},load:function(t,e){switch(this.params.backend){case"WebAudio":return this.loadBuffer(t);case"AudioElement":case"MediaElement":return this.loadMediaElement(t,e)}},loadBuffer:function(t){return this.empty(),this.downloadArrayBuffer(t,this.loadArrayBuffer.bind(this))},loadMediaElement:function(t,e){this.empty(),this.backend.load(t,this.mediaContainer,e),this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(t){this.fireEvent("error",t)}.bind(this)),!e&&this.backend.supportsWebAudio()&&this.downloadArrayBuffer(t,function(t){this.backend.decodeArrayBuffer(t,function(t){this.backend.buffer=t,this.drawBuffer()}.bind(this))}.bind(this))},downloadArrayBuffer:function(t,e){var i=this,r=WaveSurfer.util.ajax({url:t,responseType:"arraybuffer"});return r.on("progress",function(t){i.onProgress(t)}),r.on("success",e),r.on("error",function(t){i.fireEvent("error","XHR error: "+t.target.statusText)}),r},onProgress:function(t){if(t.lengthComputable)var e=t.loaded/t.total;else e=t.loaded/(t.loaded+1e6);this.fireEvent("loading",Math.round(100*e),t.target)},exportPCM:function(t,e,i){t=t||1024,e=e||1e4,i=i||!1;var r=this.backend.getPeaks(t,e),s=[].map.call(r,function(t){return Math.round(t*e)/e}),a=JSON.stringify(s);return i||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(a)),a},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.unAll(),this.backend.destroy(),this.drawer.destroy()}};WaveSurfer.Observer={on:function(t,e){this.handlers||(this.handlers={});var i=this.handlers[t];i||(i=this.handlers[t]=[]),i.push(e)},un:function(t,e){if(this.handlers){var i=this.handlers[t];if(i)if(e)for(var r=i.length-1;r>=0;r--)i[r]==e&&i.splice(r,1);else i.length=0}},unAll:function(){this.handlers=null},once:function(t,e){var i=this,r=function(){e.apply(this,arguments),setTimeout(function(){i.un(t,r)},0)};this.on(t,r)},fireEvent:function(t){if(this.handlers){var e=this.handlers[t],i=Array.prototype.slice.call(arguments,1);e&&e.forEach(function(t){t.apply(null,i)})}}},WaveSurfer.util={extend:function(t){var e=Array.prototype.slice.call(arguments,1);return e.forEach(function(e){Object.keys(e).forEach(function(i){t[i]=e[i]})}),t},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},max:function(t,e){for(var i=-1/0,r=0,s=t.length;s>r;r++){var a=t[r];null!=e&&(a=Math.abs(a-e)),a>i&&(i=a)}return i},ajax:function(t){var e=Object.create(WaveSurfer.Observer),i=new XMLHttpRequest,r=!1;return i.open(t.method||"GET",t.url,!0),i.responseType=t.responseType,i.addEventListener("progress",function(t){e.fireEvent("progress",t),t.lengthComputable&&t.loaded==t.total&&(r=!0)}),i.addEventListener("load",function(t){r||e.fireEvent("progress",t),e.fireEvent("load",t),200==i.status||206==i.status?e.fireEvent("success",i.response,t):e.fireEvent("error",t)}),i.addEventListener("error",function(t){e.fireEvent("error",t)}),i.send(),e.xhr=i,e}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,fftSize:128,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},getOfflineAudioContext:function(t){return WaveSurfer.WebAudio.offlineAudioContext||(WaveSurfer.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,t)),WaveSurfer.WebAudio.offlineAudioContext},init:function(t){this.params=t,this.ac=t.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.states=[Object.create(WaveSurfer.WebAudio.state.playing),Object.create(WaveSurfer.WebAudio.state.paused),Object.create(WaveSurfer.WebAudio.state.finished)],this.setState(this.PAUSED_STATE),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(t){t&&t.disconnect()}),this.filters=null)},setState:function(t){this.state!==this.states[t]&&(this.state=this.states[t],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(t){this.disconnectFilters(),t&&t.length?(this.filters=t,t.reduce(function(t,e){return t.connect(e),e},this.analyser).connect(this.gainNode)):this.analyser.connect(this.gainNode)},createScriptNode:function(){var t=this,e=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(e):this.ac.createJavaScriptNode(e),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){var e=t.getCurrentTime();t.state===t.states[t.PLAYING_STATE]&&t.fireEvent("audioprocess",e),t.buffer&&e>t.getDuration()&&t.setState(t.FINISHED_STATE)}},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyserData=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(t){this.gainNode.gain.value=t},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(t,e,i){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(t,function(t){e(t)}.bind(this),i)},getPeaks:function(t){for(var e=this.buffer,i=e.length/t,r=~~(i/10)||1,s=e.numberOfChannels,a=new Float32Array(t),n=0;s>n;n++)for(var o=e.getChannelData(n),h=0;t>h;h++){for(var u=~~(h*i),c=~~(u+i),d=0,l=u;c>l;l+=r){var f=o[l];f>d?d=f:-f>d&&(d=-f)}(0==n||d>a[h])&&(a[h]=d)}return a},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},waveform:function(){return this.analyser.getByteTimeDomainData(this.analyserData),this.analyserData},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},load:function(t){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=t,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return void 0===this.buffer?0:this.buffer.duration},seekTo:function(t,e){return null==t&&(t=this.getCurrentTime(),t>=this.getDuration()&&(t=0)),null==e&&(e=this.getDuration()),this.startPosition=t,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:t,end:e}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(t,e){this.createSource();var i=this.seekTo(t,e);t=i.start,e=i.end,this.source.start(0,t,e-t),this.setState(this.PLAYING_STATE)},pause:function(){this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE)},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},setPlaybackRate:function(t){t=t||1,this.isPaused()?this.playbackRate=t:(this.pause(),this.playbackRate=t,this.play())}},WaveSurfer.WebAudio.state={},WaveSurfer.WebAudio.state.playing={init:function(){},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},WaveSurfer.WebAudio.state.paused={init:function(){},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition}},WaveSurfer.WebAudio.state.finished={init:function(){this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.MediaElement=Object.create(WaveSurfer.WebAudio),WaveSurfer.util.extend(WaveSurfer.MediaElement,{init:function(t){this.params=t,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=t.mediaType.toLowerCase(),this.ac=t.audioContext||this.getAudioContext(),this.elementPosition=t.elementPosition},load:function(t,e,i){var r=this,s=document.createElement(this.mediaType);s.controls=!1,s.autoplay=!1,s.preload="auto",s.src=t,s.addEventListener("error",function(){r.fireEvent("error","Error loading media element")}),s.addEventListener("canplay",function(){r.fireEvent("canplay")}),s.addEventListener("ended",function(){r.fireEvent("finish")}),s.addEventListener("timeupdate",function(){r.fireEvent("audioprocess",r.getCurrentTime())});var a=e.querySelector(this.mediaType);a&&e.removeChild(a),e.appendChild(s),this.media=s,this.peaks=i,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return this.media.paused},getDuration:function(){var t=this.media.duration;return t>=1/0&&(t=this.media.seekable.end()),t},getCurrentTime:function(){return this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(t){this.playbackRate=t||1,this.media.playbackRate=this.playbackRate},seekTo:function(t){null!=t&&(this.media.currentTime=t)},play:function(t){this.seekTo(t),this.media.play()},pause:function(){this.media.pause()},getPeaks:function(t){return this.buffer?WaveSurfer.WebAudio.getPeaks.call(this,t):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(t){this.media.volume=t},destroy:function(){this.pause(),this.unAll(),this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),WaveSurfer.AudioElement=WaveSurfer.MediaElement,WaveSurfer.Drawer={init:function(t,e){this.container=t,this.params=e,this.width=0,this.height=e.height*this.params.pixelRatio,this.lastPos=0,this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(t){t.preventDefault();var e=this.wrapper.getBoundingClientRect();return(t.clientX-e.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0},setupWrapperEvents:function(){var t=this;this.wrapper.addEventListener("click",function(e){var i=t.wrapper.offsetHeight-t.wrapper.clientHeight;if(0!=i){var r=t.wrapper.getBoundingClientRect();if(e.clientY>=r.bottom-i)return}t.params.interact&&t.fireEvent("click",e,t.handleEvent(e))}),this.wrapper.addEventListener("scroll",function(e){t.fireEvent("scroll",e)})},drawPeaks:function(t,e){if(this.resetScroll(),this.setWidth(e),this.params.normalize)var i=WaveSurfer.util.max(t);else i=1;this.drawWave(t,i)},style:function(t,e){return Object.keys(e).forEach(function(i){t.style[i]!=e[i]&&(t.style[i]=e[i])}),t},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(t){var e=this.wrapper.scrollWidth*t;this.recenterOnPosition(e,!0)},recenterOnPosition:function(t,e){var i=this.wrapper.scrollLeft,r=~~(this.wrapper.clientWidth/2),s=t-r,a=s-i,n=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=n){if(!e&&a>=-r&&r>a){var o=5;a=Math.max(-o,Math.min(o,a)),s=i+a}s=Math.max(0,Math.min(n,s)),s!=i&&(this.wrapper.scrollLeft=s)}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(t){t!=this.width&&(this.width=t,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateWidth())},progress:function(t){var e=1/this.params.pixelRatio,i=Math.round(t*this.width)*e;if(i<this.lastPos||i-this.lastPos>=e){if(this.lastPos=i,this.params.scrollParent){var r=~~(this.wrapper.scrollWidth*t);this.recenterOnPosition(r)}this.updateProgress(t)}},destroy:function(){this.unAll(),this.container.removeChild(this.wrapper),this.wrapper=null},createElements:function(){},updateWidth:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var t=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1}));if(this.waveCc=t.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,overflow:"hidden",width:"0",height:this.params.height+"px",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var e=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=e.getContext("2d")}},updateWidth:function(){var t=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:t+"px"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:t+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(t,e){var i=.5/this.params.pixelRatio,r=this.height/2,s=r/e,a=t.length,n=1;this.params.fillParent&&this.width!=a&&(n=this.width/a),this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(e){if(e){e.beginPath(),e.moveTo(i,r);for(var o=0;a>o;o++){var h=Math.round(t[o]*s);e.lineTo(o*n+i,r+h)}e.lineTo(this.width+i,r),e.moveTo(i,r);for(var o=0;a>o;o++){var h=Math.round(t[o]*s);e.lineTo(o*n+i,r-h)}e.lineTo(this.width+i,r),e.fill(),e.fillRect(0,r-i,this.width,i)}},this)},updateProgress:function(t){var e=Math.round(this.width*t)/this.params.pixelRatio;this.style(this.progressWave,{width:e+"px"})}});(function(global,exports,perf){'use strict';function fixSetTarget(param){if(!param)
    return;if(!param.setTargetAtTime)
    param.setTargetAtTime=param.setTargetValueAtTime;}
    if(window.hasOwnProperty('webkitAudioContext')&&!window.hasOwnProperty('AudioContext')){window.AudioContext=webkitAudioContext;if(!AudioContext.prototype.hasOwnProperty('createGain'))
        AudioContext.prototype.createGain=AudioContext.prototype.createGainNode;if(!AudioContext.prototype.hasOwnProperty('createDelay'))
        AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode;if(!AudioContext.prototype.hasOwnProperty('createScriptProcessor'))
        AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode;AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain;AudioContext.prototype.createGain=function(){var node=this.internal_createGain();fixSetTarget(node.gain);return node;};AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay;AudioContext.prototype.createDelay=function(maxDelayTime){var node=maxDelayTime?this.internal_createDelay(maxDelayTime):this.internal_createDelay();fixSetTarget(node.delayTime);return node;};AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource;AudioContext.prototype.createBufferSource=function(){var node=this.internal_createBufferSource();if(!node.start){node.start=function(when,offset,duration){if(offset||duration)
        this.noteGrainOn(when,offset,duration);else
        this.noteOn(when);}}
        if(!node.stop)
            node.stop=node.noteOff;fixSetTarget(node.playbackRate);return node;};AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor;AudioContext.prototype.createDynamicsCompressor=function(){var node=this.internal_createDynamicsCompressor();fixSetTarget(node.threshold);fixSetTarget(node.knee);fixSetTarget(node.ratio);fixSetTarget(node.reduction);fixSetTarget(node.attack);fixSetTarget(node.release);return node;};AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter;AudioContext.prototype.createBiquadFilter=function(){var node=this.internal_createBiquadFilter();fixSetTarget(node.frequency);fixSetTarget(node.detune);fixSetTarget(node.Q);fixSetTarget(node.gain);return node;};if(AudioContext.prototype.hasOwnProperty('createOscillator')){AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator;AudioContext.prototype.createOscillator=function(){var node=this.internal_createOscillator();if(!node.start)
        node.start=node.noteOn;if(!node.stop)
        node.stop=node.noteOff;fixSetTarget(node.frequency);fixSetTarget(node.detune);return node;};}}}(window));var audioSystem=new function(){this.AVG_BYTES_PER_SOUND=16384;this.unsupportedBrowser=false;this.useSoundSprite=true;this.sounds={};this.gainNodes={};this.volumeIndex=[];this.masterVolume=1;this.load=null;this.play=null;this.bytesTotal=0;this.bytesReceived=0;this.progress={};this.audioTrack=null;this.audioTrackSource=null;this.audioTrackPlaying=false;this.init=function(){if(typeof webkitAudioContext!='undefined'){this.load=this.loadWebkit;this.play=this.playWebkit;this.audioContext=new webkitAudioContext();}else if(typeof AudioContext!='undefined'){this.load=this.loadWebkit;this.play=this.playWebkit;this.audioContext=new AudioContext();}else{this.load=function(){document.onLoadSound()};this.play=function(){};this.unsupportedBrowser=true;}};this.getProgress=function(){var bytesTotal=0;var bytesReceived=0;for(var instrument in audioSystem.progress){if(audioSystem.progress[instrument]!=undefined){if(window.enableSynth&&instrument!=2){bytesReceived++;bytesTotal++;}else{bytesReceived+=audioSystem.progress[instrument][0];bytesTotal+=audioSystem.progress[instrument][1];}}}
    if(bytesTotal==0){return 1;}else{return bytesReceived/bytesTotal;}}
    this.setVolume=function(volume){this.masterVolume=volume;for(var i in this.gainNodes){this.gainNodes[i].gain.value=this.canUseSoundSprite(i)?settings['volume'][i]*volume:0.5*volume;}}
    this.loadWebkit=function(instrument,note){var id=this.id(instrument,note);var data=this.url(instrument,note);var request=new XMLHttpRequest();request.open('GET',data,true);request.responseType='arraybuffer';request.onload=function(){audioSystem.audioContext.decodeAudioData(request.response,function(buffer){audioSystem.sounds[id]=buffer;audioSystem.progress[instrument][0]+=audioSystem.AVG_BYTES_PER_SOUND;document.onLoadSound();});};request.send();};this.loadSoundSpriteWebkit=function(instrument){this.progress[instrument]=[0,1];var data='/app/instruments/'+instrument+'.'+window.audioFormat+'?v='+settings['audioVersion'];var request=new XMLHttpRequest();request.open('GET',data,true);request.responseType='arraybuffer';request.onload=function(){audioSystem.audioContext.decodeAudioData(request.response,function(buffer){audioSystem.progress[instrument]=[1,1];audioSystem.sounds[instrument]=buffer;document.onLoadSound();});};request.onprogress=function(e){if(e.lengthComputable){audioSystem.progress[instrument]=[Math.min(e.total-1,e.loaded),e.total];document.onLoadSound();}}
        request.send();};this.playWebkit=function(instrument,note,delay){var id=this.id(instrument,note);delay=delay?delay:0;if(this.canUseSoundSprite(instrument)&&this.sounds[instrument]!=undefined){var source=this.audioContext.createBufferSource();source.buffer=this.sounds[instrument];if(settings['altVolume'][instrument]!=0){var tmp=settings['altVolume'][instrument];settings['altVolume'][instrument]=settings['volume'][instrument];settings['volume'][instrument]=tmp;this.gainNodes[instrument].gain.value=settings['volume'][instrument]*this.masterVolume;}
        source.connect(this.gainNodes[instrument]);var startTime=this.audioContext.currentTime+delay;var offset=30/settings['originalBpm'][instrument]*(note-settings['min'][instrument]);var length=30/settings['originalBpm'][instrument]-0.05;source.start?source.start(startTime,offset,length):source.noteOn(startTime,offset,length);delete source;}else if(this.sounds[id]!=undefined){var source=this.audioContext.createBufferSource();source.buffer=this.sounds[id];source.connect(this.gainNodes[instrument]);var startTime=this.audioContext.currentTime+delay;source.start?source.start(startTime):source.noteOn(startTime);delete source;}};this.loadInstrument=function(id){this.gainNodes[id]=this.audioContext.createGain();this.gainNodes[id].gain.value=this.canUseSoundSprite(id)?settings['volume'][id]*this.masterVolume:0.5*this.masterVolume;this.gainNodes[id].connect(this.audioContext.destination);if(this.canUseSoundSprite(id)){this.loadSoundSpriteWebkit(id);}else{this.progress[id]=[0,0];var count=0;for(var i=settings['min'][id];i<=settings['max'][id];i++)
    {this.load(id,i-settings['offset'][id]);count++;}
        this.progress[id]=[0,count*audioSystem.AVG_BYTES_PER_SOUND];}};this.loadAudioTrack=function(arrayBuffer,onLoad){this.audioContext.decodeAudioData(arrayBuffer,function(buffer){audioSystem.audioTrack=buffer;onLoad(buffer);},function(e){audioSystem.audioTrack=null;message('Error loading audio track');audioTrackLoading.style.display="none";audioTrackSelect.style.display="block"});}
    this.removeAudioTrack=function(){if(this.audioTrack!=null){if(this.audioTrackPlaying){this.stopAudioTrack();}
        this.audioTrack=null;}}
    this.playAudioTrack=function(offset){if(this.audioTrack!=null){if(this.audioTrackPlaying){this.stopAudioTrack();}
        this.audioTrackPlaying=true;this.audioTrackSource=this.audioContext.createBufferSource();this.audioTrackSource.buffer=this.audioTrack;this.audioTrackSource.loop=false;this.audioTrackSource.connect(this.audioContext.destination);this.audioTrackSource.start(0,offset);}}
    this.stopAudioTrack=function(){if(this.audioTrackSource!=null){this.audioTrackSource.stop();this.audioTrackSource=null;}}
    this.canUseSoundSprite=function(id){return this.useSoundSprite&&(id<1||id>=8);}
    this.id=function(instrument,note){return instrument+"-"+note;};this.url=function(instrument,note){return"/app/sounds/"+this.id(instrument,note)+'.'+window.audioFormat+'?v='+settings['audioVersion'];};}
var endpoint="/app/api";function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n);}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0),j=this.length;i<j;i++){if(this[i]===obj){return i;}}
    return-1;}}
piano=[];pianoToIndex={};var k=0;for(var i=7;i>=2;i--)
{for(var j=settings['pianoNotes'].length-1;j>=0;j--)
{var name=settings['pianoNotes'][j]+i;piano.push(name);pianoToIndex[name]=k;k++;}}
function detectScale(notes){var scaleFrequency={};for(var i=0;i<settings['scales'].length;i++){scaleFrequency[i]=0;}
    var totalNotes=0;for(var i=0;i<notes.length;i++){var note=notes[i].type.substring(0,notes[i].type.length-1);if(note.instrument==2)
        continue;totalNotes++;for(var j=0;j<settings['scales'].length;j++){if(settings['scales'][j].indexOf(note)>-1){scaleFrequency[j]++;}}}
    var maxScale;var maxFrequency=0;for(var i=0;i<settings['scales'].length;i++){if(scaleFrequency[i]>maxFrequency){maxFrequency=scaleFrequency[i];maxScale=i;}}
    var f=maxFrequency/totalNotes;if(f>0.9)
        return maxScale;else
        return-1;}
function updateScale(notes){var scaleIndex=detectScale(notes);if(scaleIndex>0){scale=settings['scales'][scaleIndex];keySelect.selectedIndex=scaleIndex;updateKeys();}}
var id=0;function Note(song,type,time,length,instrument){this.song=song;this.time=time;this.intTime=Math.floor(time);this.fracTime=this.time-this.intTime;this.type=type;this.length=length;this.instrument=instrument;this.selected=false;this.id=id++;}
Note.prototype.toString=function(startTime){return(this.time-startTime)+" "+this.type+" "+this.length+" "+this.instrument;}
function Song(data){this.playing=false;this.stopping=false;this.notes=[];this.loopTime=0;this.noteColumns=[];this.basedon=0;this.appendData(data,0);this.worker=new Worker('/app/sequencer.worker.js');this.worker.addEventListener('message',function(e){if(song.playing)
    song.playNextColumn(true);});updateScale(this.notes);}
Song.prototype.appendData=function(data,startTime,selectNotes){data=data.split(";");var maxTime=0;for(var i=0;i<data.length;i++){noteArray=data[i].split(' ');if(noteArray[1]!=undefined){var time=parseFloat(noteArray[0]);noteInstrument=noteArray.length>3?parseInt(noteArray[3]):0;if(loadedInstruments[noteInstrument]==false){loadInstrument(noteInstrument);}
    var note=new Note(this,noteArray[1],time-startTime,noteArray[2],noteInstrument);this.addNote(note);if(selectNotes)
        select(note);if(note.intTime>maxTime){maxTime=note.intTime;}}}
    if(maxTime<64)
        maxTime=64;updateLength(maxTime+16);}
Song.prototype.addNote=function(note){var noteIndex=piano.indexOf(note.type);if(noteIndex!=-1){this.notes.push(note);note.element=document.createElement('div');note.element.noteData=note;sequencer.appendChild(note.element);note.element.className="note instrument"+note.instrument;this.update(note);this.moveNote(note,undefined,note.instrument,undefined,note.time,undefined,note.type);this.updateLoopTime();}}
Song.prototype.removeNote=function(note){note.deleted=true;this.notes.splice(this.notes.indexOf(note),1);delete this.noteColumns[note.intTime][note.id];sequencer.removeChild(note.element);this.updateLoopTime();}
Song.prototype.moveNote=function(note,oldInstrument,newInstrument,oldTime,newTime,oldType,newType){if(note.deleted)
    return;note.time=newTime;note.intTime=Math.floor(note.time);note.fracTime=note.time-note.intTime;note.type=newType;note.instrument=newInstrument;if(oldTime!=undefined){delete this.noteColumns[Math.floor(oldTime)][note.id]}
    if(this.noteColumns[note.intTime]==null)
        this.noteColumns[note.intTime]={};this.noteColumns[note.intTime][note.id]=note;if(note.length>=0.75)
        note.element.innerHTML=newType;return true;}
Song.prototype.updateLoopTime=function(){this.loopTime=0;for(var i=0;i<this.notes.length;i++){if(this.notes[i].intTime+Math.ceil(this.notes[i].length)>=this.loopTime)
    this.loopTime=this.notes[i].intTime;}
    this.loopTime=Math.floor(this.loopTime/16)*16+16;if(this.loopTime>=maxCells)
        updateLength(this.loopTime+16);}
noteWidth=25;noteHeight=16;function getButton(event){if('which'in event){return event.which;}
else{if('button'in event){var buttons="";if(event.button&1){return 1;}
    if(event.button&2){return 2;}
    if(event.button&4){return 3;}}}}
function sendPostRequest(path,params,method){method=method||"post";var form=document.createElement("form");form.setAttribute("method",method);form.setAttribute("action",path);for(var key in params){if(params.hasOwnProperty(key)){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",params[key]);form.appendChild(hiddenField);}}
    document.body.appendChild(form);form.submit();}
function updateLength(length){length=Math.floor(length/16)*16+16;maxCells=length;document.getElementById("sequencer_inner").style.width=(length*25)+"px";}
function getFrequency(n){return Math.round(440*Math.pow(2,(piano.length-piano.indexOf(n)-1+3-36)/12));}
var poly=64;var oscillators={};var synthTime=0;var oscillatorType="triangle";var created=false;function initSynth(context){for(var i=0;i<piano.length;i++){var n=piano[i];oscillators[n]=context.createOscillator();var o=oscillators[n];o.type="triangle";o.frequency.value=getFrequency(n);var gain=context.createGain();gain.gain.value=0;o.connect(gain);gain.connect(context.destination);o.gain=gain;o.inUse=false;o.inUseTime=0;o.start?o.start(0):o.noteOn(0);}
    created=true;}
function playSynthNote(context,note,time,type){if(!created)
    initSynth(context);synthTime++;var oscillator=oscillators[note];if(oscillator){(function(synthTime){if(oscillatorType)
    oscillator.type=oscillatorType;oscillator.inUseTime=synthTime;oscillator.inUse=true;oscillator.gain.gain.value=0.1;window.setTimeout(function(){if(oscillator.inUseTime==synthTime){oscillator.gain.gain.value=0;oscillator.inUse=false;}},time);})(synthTime);}}
var $=jQuery;var instanceId=Math.random()*1048576|0;var isMobile=navigator.userAgent.indexOf('Android')>-1||navigator.userAgent.indexOf('iPhone')>-1;var RULE_NOTE=0;var RULE_KEY=1;var RULE_SEQUENCER_KEY=2;var RULE_INSTRUMENT=3;var focused=true;var mainStylesheet;var zoomLevel=1;var grid=1;var autoScroll=1;var instrument=0;var instrumentLock=[];var keyElements=[];var keyRowElements=[];var keyTextElements=[];var scale=[];var zeroClipboard;var clipboard=[];var clipboardTime;var clickedButton=false;var mouseButton=0;var mode="draw"
var maxCells;var bpm;var lastStepTime;var selectOpen=false;var selectedNotes=[];var dragNotes=[];var clickedNote=false;var sequencer;var mouseX,mouseY;var mouseClickX,mouseClickY;var playhead;var playTime=0;var playTimeoutId=0;var lastPlayTime=0;var autoplay=false;var onLoop=null;var scrollLeft=0;var targetScrollLeft=0;var wavesurferObj;var wavesurferScale=2;function createKey(t,addHighlight){var div=document.createElement('div');var div_t=document.createElement('div');div_t.innerHTML=t;div_t.className='key_text';if(addHighlight){var div_h=document.createElement('div');div_h.id='key_highlight_'+t;div.appendChild(div_h);}
    div.appendChild(div_t);keyTextElements.push(div_t);div.className=addHighlight?(t.length==3?"key_sharp":"key"):"sequencer_key";if(addHighlight){div.onmousedown=function(){var btn=getButton(event);mouseButton=btn;playNote(instrument,t,1);};div.onmouseover=function(){if(mouseButton==1&&dragNotes.length==0){playNote(instrument,t,1);}};}
    return div;}
function displayKeys(){for(var i=0;i<piano.length;i++){var leftElement=createKey(piano[i],true);keyboard.appendChild(leftElement);keyElements.push(leftElement);}
    for(var i=0;i<keyElements.length;i++){var rowElement=createKey(piano[i],false);keyboard_table.appendChild(rowElement);keyRowElements.push(rowElement);}}
function updateKeys(){for(var i=0;i<keyTextElements.length;i++){if(settings['numNotes']-i-1>=settings['min'][instrument]&&settings['numNotes']-i-1<=settings['max'][instrument]){if(instrument==2)
    keyTextElements[i].innerHTML=settings['percussion'][i-8];else
    keyTextElements[i].innerHTML=piano[i];if(scale.indexOf(settings['pianoNotes'][(keyTextElements.length-i-1)%12])>-1)
    keyRowElements[i].className="sequencer_key highlight";else
    keyRowElements[i].className="sequencer_key";}
else
    keyTextElements[i].innerHTML="";}}
function playNote(instrument,name,length,delay){if(window.enableSynth&&instrument!=2){playSynthNote(audioSystem.audioContext,name,length*song.sleepTime,2,delay);return;}
    idx=pianoToIndex[name];if(settings['numNotes']-idx-1>=settings['min'][instrument]&&settings['numNotes']-idx-1<=settings['max'][instrument])
        audioSystem.play(instrument,(settings['numNotes']-(idx+settings['offset'][instrument])-1),delay);document.getElementById('key_highlight_'+name).className='instrument'+instrument;window.setTimeout(function(){document.getElementById('key_highlight_'+name).className='';},length*song.sleepTime);}
Song.prototype.update=function(note)
{var noteIndex=pianoToIndex[note.type];var x=noteWidth*note.time;var y=noteHeight*noteIndex;var width=noteWidth*note.length;note.element.style.width=(width-4)+"px";note.element.style.top=y+"px";note.element.style.left=x+"px";}
Song.prototype.setBPM=function(v)
{if(!isNumber(v))
    v=110;v=Math.max(v,10);bpm=v;if(bpm>200){scrollSelect.selectedIndex=autoScroll=1;}
    var nps=(v*4)/60;this.sleepTime=(1/nps)*1000;this.worker.postMessage(this.sleepTime);updateWavesurferWidth(true);}
Song.prototype.play=function(start){this.playing=true;playTime=start;if(isMobile){if(playTimeoutId)
    window.clearTimeout(playTimeoutId);this.playColumn(start,true,false);}
else
    song.worker.postMessage('start');button.style.backgroundImage="url(/app/stop.gif)";this.playPos=start;playhead.style.display="block";lastStepTime=new Date().getTime();lastPlayTime=start;}
Song.prototype.stop=function(){this.playing=false;if(isMobile)
    window.clearTimeout(playTimeoutId);else
    this.worker.postMessage('stop');button.style.backgroundImage="url(/app/play.gif)";playhead.style.display="none";audioSystem.stopAudioTrack();}
var scrollIntervalId=0;function setScrollDelta(x){setScrollLeft(scrollLeft+x);}
function setScrollLeft(x){if(autoScroll==0){targetScrollLeft=Math.min(Math.max(x,0),container.scrollWidth-container.clientWidth);if(scrollIntervalId!=0)
    window.clearInterval(scrollIntervalId);scrollIntervalId=window.setInterval(function(){var d=targetScrollLeft-scrollLeft;if(Math.abs(d)<2){scrollLeft=container.scrollLeft=targetScrollLeft;window.clearInterval(scrollIntervalId);}
else{scrollLeft+=d/2;container.scrollLeft=Math.round(scrollLeft);}},66);}else if(autoScroll==1){scrollLeft=container.scrollLeft=Math.round(x);}}
Song.prototype.playColumn=function(idx,first,single){playhead.style.left=idx*noteWidth+"px";if(idx*noteWidth>scrollLeft+7*clientWidth/8){setScrollDelta(3*clientWidth/4);}
    if(idx==maxCells||idx>=song.loopTime){if(onLoop==null){idx=0;if(idx*noteWidth<scrollLeft){setScrollLeft(0);}
        audioSystem.playAudioTrack(0);}
    else{onLoop();song.stop();}}
    if(first||idx%16==0){audioSystem.playAudioTrack(song.sleepTime*idx/1000);}
    if(this.noteColumns[idx]!=undefined)
        this.playNotes(this.noteColumns[idx]);var elapsed=new Date().getTime()-lastStepTime;var diff=Math.min(song.sleepTime/2,Math.max(0,elapsed-song.sleepTime));if(!single){playTimeoutId=window.setTimeout(function(){if(song.playing)
        song.playColumn(idx+1,false,false);},this.sleepTime-diff);}
    lastStepTime=new Date().getTime();return idx+1;}
Song.prototype.playNotes=function(list){for(var i in list){var note=list[i];playNote(note.instrument,note.type,note.length,song.sleepTime*note.fracTime/1000);}}
Song.prototype.playNextColumn=function(isWorker){if(song.playing){playTime=song.playColumn(playTime,false,true);}}
function loadInstrument(id){loading=true;if(!loadedInstruments[id])
    document.getElementById("loading_container").style.display="block";loadedInstruments[id]=true;if(enableSynth&&id!=2){for(var i=settings['min'][id];i<=settings['max'][id];i++){document.onLoadSound();}}else{audioSystem.loadInstrument(id);}}
function setNoteSize(){mainStylesheet.cssRules[RULE_NOTE].style.height=(noteHeight-4)+"px";mainStylesheet.cssRules[RULE_NOTE].style.lineHeight=(noteHeight-4)+"px";mainStylesheet.cssRules[RULE_NOTE].style.fontSize=(noteHeight*0.625)+"px";mainStylesheet.cssRules[RULE_KEY].style.height=noteHeight+"px";mainStylesheet.cssRules[RULE_KEY].style.lineHeight=noteHeight+"px";mainStylesheet.cssRules[RULE_KEY].style.fontSize=(noteHeight*0.625)+"px";sequencer.style.height=(piano.length*noteHeight+2)+"px"}
function zoom(v){oldZoom=zoomLevel
    zoomLevel=v;document.getElementById('sequencer_background').style.zoom=v;noteWidth=25*v;noteHeight=16*v;setNoteSize();for(var note in song.notes){song.update(song.notes[note]);}
    container.scrollTop=scrollTop=scrollTop*(zoomLevel/oldZoom);zoomLevel=v;updateWavesurferWidth(true);}
function zoomIn(){zoom(zoomLevel*1.25);}
function zoomOut(){zoom(zoomLevel/1.25);}
function create(){mainStylesheet=document.getElementById('css_vars').sheet;scrollLeft=0;scrollTop=0;loadedInstruments=[];for(var i=0;i<settings['instruments'].length;i++){loadedInstruments.push(false);}
    container=document.getElementById("sequencer_main");clientWidth=container.clientWidth;sequencer=document.getElementById("sequencer_inner");sequencerRect=sequencer.getBoundingClientRect();wavesurfer=document.getElementById("wavesurfer_element");keyboard=document.getElementById("keyboard_element");keyboard_wrapper=document.getElementById("keyboard_wrapper_element");keyboard_table=document.getElementById("sequencer_keyboard");instrumentSelect=document.getElementById('instrument_select');keySelect=document.getElementById('key_select');gridSelect=document.getElementById('grid_select');scrollSelect=document.getElementById('scroll_select');audioTrackLink=document.getElementById('audio_track_link');audioTrackLoading=document.getElementById('audio_track_loading');audioTrackSelect=document.getElementById('audio_track');audioTrackFile=document.getElementById('audio_track_file');audioTrackRemove=document.getElementById('audio_track_remove');selectionRect=document.getElementById('selection_rect');copyButton=document.getElementById('btn_copy');window.onresize=function(){clientWidth=container.clientWidth;};setNoteSize();displayKeys();document.onLoadSound=function(){document.getElementById("loading").style.width=Math.round(audioSystem.getProgress()*100)+"%";if(audioSystem.getProgress()>=1){document.getElementById("loading_container").style.display="none";loading=false;if(autoplay&&!song.playing){song.play(0);autoplay=false;}}}
    audioSystem.init({force:"audioTag",audioTagTimeToLive:1000});if(window.enableSynth)
        initSynth(audioSystem.audioContext);if(audioSystem.unsupportedBrowser)
        message("Audio is not supported in your browser.");var option=document.createElement("option");option.value=0;option.innerHTML=settings['instruments'][0];instrumentSelect.appendChild(option);var option=document.createElement("option");option.value=8;option.innerHTML=settings['instruments'][8];instrumentSelect.appendChild(option);for(var i=1;i<8;i++){var option=document.createElement("option");option.value=i;option.innerHTML=settings['instruments'][i];instrumentSelect.appendChild(option);}
    for(var i=9;i<settings['instruments'].length;i++){var option=document.createElement("option");option.value=i;option.innerHTML=settings['instruments'][i];instrumentSelect.appendChild(option);}
    var instrumentOptions1=document.getElementById('instrument_options_1');var instrumentOptions2=document.getElementById('instrument_options_2');var numLeftColumn=Math.ceil(instrumentSelect.children.length/2);for(var i=0;i<instrumentSelect.children.length;i++){var name=instrumentSelect.children[i].innerHTML;var id=instrumentSelect.children[i].value;var html='<div class="instrument_option">';html+='<div id="instrument_lock_'+id+'" class="instrument_lock btn" onclick="lockInstrument('+id+')" title="Lock this instrument"></div>';html+='<span id="instrument_name_'+id+'" onclick="selectInstrument('+i+')">'+name+'</span></div>';if(i<numLeftColumn){instrumentOptions1.innerHTML+=html;}else{instrumentOptions2.innerHTML+=html;}}
    for(var i=0;i<settings['instruments'].length;i++){instrumentLock[i]=false;mainStylesheet.insertRule('.instrument'+i+' {cursor: pointer; z-index: 96;}',mainStylesheet.cssRules.length);}
    instrumentSelect.onchange=function()
    {instrument=parseInt(instrumentSelect.value);if(!loadedInstruments[instrument])
        loadInstrument(instrument);updateKeys();for(var i=0;i<selectedNotes.length;i++){song.moveNote(selectedNotes[i],selectedNotes[i].instrument,instrument,selectedNotes[i].time,selectedNotes[i].time,selectedNotes[i].type,selectedNotes[i].type);select(selectedNotes[i]);}
        selectOpen=false;}
    function updateVolume(){audioSystem.setVolume($('#volume_slider').slider('value'));}
    $('#volume_slider').slider({max:2,min:0,slide:updateVolume,change:updateVolume,value:1,step:0.01});for(var i=0;i<settings['scales'].length;i++){var option=document.createElement("option");option.innerHTML=settings['scaleNames'][i];keySelect.appendChild(option);}
    keySelect.onchange=function(){scale=settings['scales'][keySelect.selectedIndex];updateKeys();selectOpen=false;}
    instrumentSelect.onmousedown=keySelect.onmousedown=function(){selectOpen=true};gridSelect.onchange=function(){grid=gridSelect.value;}
    scrollSelect.onchange=function(){autoScroll=scrollSelect.value;}
    audioTrackFile.addEventListener('change',function(e){var reader=new FileReader();reader.onload=function(e){audioTrackSelect.style.display="none";audioTrackLoading.style.display="block";if(wavesurferObj==null){wavesurferObj=Object.create(WaveSurfer);wavesurferObj.init({audioContext:audioSystem.audioContext,height:32,pixelRatio:1,interact:false,container:wavesurfer,waveColor:'orange',progressColor:'orange',normalize:true});}
        audioSystem.loadAudioTrack(e.target.result,function(buffer){window.setTimeout(function(){$('#wavesurfer_element').show();wavesurferObj.loadDecodedBuffer(buffer);updateWavesurferWidth(true);},0);audioTrackLoading.style.display="none";audioTrackLink.style.display="block";});};reader.readAsArrayBuffer(e.target.files[0]);},false);container.onscroll=function(){keyboard.style.top=(-container.scrollTop+1)+"px";wavesurfer.style.top=container.scrollTop+"px";var dx=container.scrollLeft-scrollLeft;var dy=container.scrollTop-scrollTop;mouseClickX-=dx;mouseClickY-=dy;scrollLeft=container.scrollLeft;scrollTop=container.scrollTop;sequencerRect=sequencer.getBoundingClientRect();updateSelectionRectangle(mouseX,mouseY);updateDragNotes(mouseX,mouseY,mouseX-dx,mouseY-dy);};document.getElementById("sequencer_inner").style.width=length*100;document.onmouseup=onmouseup;sequencer.onmousedown=onmousedown;document.onmousemove=onmousemove;container.onkeypress=onkeypress;container.onkeydown=onkeydown;container.onmouseover=function(){if(!selectOpen)
        container.focus();document.oncontextmenu=function(){return false;};}
    container.onmouseout=function(){document.oncontextmenu=function(){return true;};updateSelection();}
    button=document.getElementById('play_small');button.onmousedown=function(){if(song.playing){song.stop();}
    else{song.play(0);}};keyboardIcon=document.getElementById('keyboard_icon');keyboardOptions=document.getElementById('keyboard_options')
    keyboardIcon.onmouseover=function(){keyboardOptions.style.display='block'};keyboardIcon.onmouseout=function(){keyboardOptions.style.display='none'};playhead=document.createElement('div');playhead.className="playhead";sequencer.appendChild(playhead);setMode('draw');updateKeys();mainInit();ZeroClipboard.config({swfPath:'/resources/ZeroClipboard.swf'});zeroClipboard=new ZeroClipboard(document.getElementById("btn_copy"));zeroClipboard.on("ready",function(readyEvent){zeroClipboard.on("aftercopy",function(event){copy(true);});});}
function lockInstrument(id){instrumentLock[id]=!instrumentLock[id];if(instrumentLock[id]){document.getElementById('instrument_name_'+id).className="instrument_name_locked";mainStylesheet.cssRules[RULE_INSTRUMENT+id].style.opacity='0.25';mainStylesheet.cssRules[RULE_INSTRUMENT+id].style.zIndex=95;mainStylesheet.cssRules[RULE_INSTRUMENT+id].style.cursor='default';}else{document.getElementById('instrument_name_'+id).className="instrument_name";mainStylesheet.cssRules[RULE_INSTRUMENT+id].style.opacity='1';mainStylesheet.cssRules[RULE_INSTRUMENT+id].style.zIndex=96;mainStylesheet.cssRules[RULE_INSTRUMENT+id].style.cursor='pointer';}}
function showHideInstrumentOptions(){if($('#instrument_options').is(':visible')){$('#btn_instrument_options').css('backgroundImage','url(/app/arrow_down.png)');}else{$('#btn_instrument_options').css('backgroundImage','url(/app/arrow_up.png)');}
    $('#instrument_options').slideToggle();}
function xPosition(x){return x-sequencerRect.left;}
function yPosition(y){return y-sequencerRect.top;}
function timeIndex(x){return Math.floor(x/noteWidth/(1/grid))/grid;}
function noteIndex(y){return Math.floor(y/noteHeight);}
function timeIndexRound(x){return Math.round(x/noteWidth/(1/grid))/grid;}
function noteIndexRound(y){return Math.round(y/noteHeight);}
function onNoteClick(event){var element=document.elementFromPoint(event.clientX,event.clientY);if(element!=undefined&&element.noteData!=undefined&&!instrumentLock[element.noteData.instrument]){var note=element.noteData;if(note.selected==false){clearSelection();select(note);}
    dragSelection();playNote(note.instrument,note.type,note.length);window.top.confirmExit=true;return clickedNote=true;}
else{clearSelection();return clickedNote=false;}}
function mouseDownDraw(event){if(!onNoteClick(event)){x=xPosition(event.clientX);y=yPosition(event.clientY);if(x>0&&y>0&&!instrumentLock[instrument]){type=piano[noteIndex(y)];playNote(instrument,type,1);time=timeIndex(x);var note=new Note(song,type,time,1/grid,instrument);if(time<=maxCells&&type!=undefined){if(!loadedInstruments[instrument])
    loadInstrument(instrument);song.addNote(note);dragNotes=[];dragNotes.push(note);}
    window.top.confirmExit=true;}}}
function mouseDownEdit(event){onNoteClick(event);}
function mouseDownPlay(event){x=xPosition(event.clientX);time=Math.floor(timeIndex(x));if(!song.playing)
    song.play(time);else
    song.stop();}
function mouseDownErase(event){var element=document.elementFromPoint(event.clientX,event.clientY);if(element.noteData!=undefined&&!instrumentLock[element.noteData.instrument]){song.removeNote(element.noteData);window.top.confirmExit=true;}}
function onmousedown(event){if(clickedButton){clickedButton=false;return;}
    var btn=getButton(event);mouseButton=btn;if(btn==1){if(mode=="draw"){mouseDownDraw(event);}
    else if(mode=="edit"){mouseDownEdit(event);}
    else if(mode=="play"){mouseDownPlay(event);}
    else if(mode=="erase"){mouseDownErase(event);}
        mouseClickX=event.clientX;mouseClickY=event.clientY;}
    else if(btn==2){mouseDownPlay(event);event.stopPropagation()
        event.preventDefault();}
    else if(btn==3){mouseDownErase(event);}}
function setMode(m){document.getElementById("mode_"+mode).className="btn tooltip";mode=m;document.getElementById("mode_"+mode).className="active tooltip";}
function select(note){note.element.className='note instrument'+note.instrument+' selected';if(note.selected)
    return;note.selected=true;selectedNotes.push(note);}
function deselect(note){if(!note.selected)
    return;note.selected=false;selectedNotes.splice(selectedNotes.indexOf(note),1);note.element.className='note instrument'+note.instrument;}
function clearSelection(){for(var i=0;i<selectedNotes.length;i++){selectedNotes[i].selected=false;selectedNotes[i].element.className='note instrument'+selectedNotes[i].instrument;}
    selectedNotes=[];}
function deleteSelection(){for(var i=0;i<selectedNotes.length;i++){selectedNotes[i].selected=false;selectedNotes[i].element.className='note instrument'+selectedNotes[i].instrument;song.removeNote(selectedNotes[i]);}
    selectedNotes=[];}
function dragSelection(){dragNotes=[];for(var i=0;i<selectedNotes.length;i++){dragNotes.push(selectedNotes[i]);}}
function getCopyString(notes,minTime){var string=settings['clipboardMagicString']+':'+instanceId+':';for(var i=0;i<notes.length;i++){string+=notes[i].toString(minTime)+';';}
    return string;}
function updateSelection(){var minTime=0;if(selectedNotes.length>0){minTime=selectedNotes[0].time;for(var i=0;i<selectedNotes.length;i++){if(selectedNotes[i].time<minTime){minTime=selectedNotes[i].time;if(minTime==0){break;}}}}
    copyButton.setAttribute('data-clipboard-text',getCopyString(selectedNotes,minTime));}
function selectAll(){if(selectedNotes.length==song.notes.length)
    clearSelection();else{for(var i=0;i<song.notes.length;i++){if(!instrumentLock[song.notes[i].instrument]){select(song.notes[i]);}}
    if(selectedNotes.length>0){message(selectedNotes.length+" note"+(selectedNotes.length==1?"":"s")+" selected");}}
    updateSelection();}
function cut(){copy(false);if(selectedNotes.length==0){message("Select some notes to cut first.");}
else{message(clipboard.length+" note"+(selectedNotes.length==1?"":"s")+" copied.");}
    deleteSelection();}
function cloneNote(note){return new Note(song,note.type,note.time,note.length,note.instrument);}
function copy(showMessage){clipboard=[];for(var i=0;i<selectedNotes.length;i++){clipboard.push(cloneNote(selectedNotes[i]));}
    if(showMessage){if(selectedNotes.length==0){message("Select some notes to copy first.");}
    else{message(clipboard.length+" note"+(selectedNotes.length==1?"":"s")+" copied.");}}}
function paste(){clearSelection();if(clipboard.length>0)
    message(clipboard.length+" note"+(selectedNotes.length==1?"":"s")+" pasted. Drag them to change their position.");else
    message('Nothing to paste. Use Ctrl-V if pasting from another sequence.');for(var i=0;i<clipboard.length;i++){var note=clipboard[i];song.addNote(note);select(note);}
    copy(false);}
$(document).on('paste','body',function(e){var text=(e.originalEvent||e).clipboardData.getData('text/plain')||prompt('Paste something..');if(text){var parts=text.split(':');if(parts.length==3&&parts[0]==settings['clipboardMagicString']&&parseInt(parts[1])!=instanceId){clearSelection();song.appendData(parts[2],0,true);}else{paste();}}});$(document).on('copy','body',function(e){e.preventDefault();});function updateSelectionRectangle(mouseX,mouseY){if(mouseButton==1&&mode=="edit"&&!clickedNote){selectionRect.style.display="block";if(mouseClickX<mouseX){selectionRect.style.left=xPosition(mouseClickX)+"px";selectionRect.style.width=(mouseX-mouseClickX)+"px";}
else{selectionRect.style.left=xPosition(mouseX)+"px";selectionRect.style.width=(mouseClickX-mouseX)+"px";}
    if(mouseClickY<mouseY){selectionRect.style.top=yPosition(mouseClickY)+"px";selectionRect.style.height=(mouseY-mouseClickY)+"px";}
    else{selectionRect.style.top=yPosition(mouseY)+"px";selectionRect.style.height=(mouseClickY-mouseY)+"px";}}}
function updateDragNotes(mouseX,mouseY,prevMouseX,prevMouseY){for(var i=0;i<dragNotes.length;i++){var dragNote=dragNotes[i];dragNote.element.style.left=(parseInt(dragNote.element.style.left)+mouseX-prevMouseX)+"px";dragNote.element.style.top=(parseInt(dragNote.element.style.top)+mouseY-prevMouseY)+"px";}}
function onmousemove(event){if((mouseButton==1&&mode=="erase")||mouseButton==3)
    mouseDownErase(event);else
    updateSelectionRectangle(event.clientX,event.clientY);updateDragNotes(event.clientX,event.clientY,mouseX,mouseY);mouseX=event.clientX;mouseY=event.clientY;time=timeIndex(xPosition(event.clientX));time=(Math.floor(time/4))}
function onmouseup(event){if(mode=="edit"&&!clickedNote&&mouseButton==1){selectionRect.style.display="none";var xPos=xPosition(event.clientX);var yPos=yPosition(event.clientY);var xClickPos=xPosition(mouseClickX);var yClickPos=yPosition(mouseClickY);var startX,stopX,startY,stopY
    if(xClickPos<xPos){startX=timeIndex(xClickPos);stopX=timeIndex(xPos);}
    else{stopX=timeIndex(xClickPos);startX=timeIndex(xPos);}
    if(yClickPos<yPos){startY=noteIndex(yClickPos);stopY=noteIndex(yPos);}
    else{stopY=noteIndex(yClickPos);startY=noteIndex(yPos);}
    clearSelection();for(var i=0;i<song.notes.length;i++){var note=song.notes[i];if(note.time>=startX&&note.time<=stopX){var index=pianoToIndex[note.type];if(index>=startY&&index<=stopY&&!instrumentLock[note.instrument]){select(note);}}}}
    for(var index in dragNotes){var dragNote=dragNotes[index];x=parseInt(dragNote.element.style.left);y=parseInt(dragNote.element.style.top);note=piano[noteIndexRound(y)];time=timeIndexRound(x);if(note!=undefined&&time<maxCells&&time>=0){song.updateLoopTime();song.moveNote(dragNote,dragNote.instrument,dragNote.instrument,dragNote.time,time,dragNote.type,note);}
        song.update(dragNote);}
    dragNotes=[];mouseButton=0;}
function selectInstrument(index){instrumentSelect.selectedIndex=index;instrumentSelect.onchange();}
function onkeydown(event){var code=event.keyCode;if(code==8||code==46){deleteSelection();return false;}else if(code>=49&&code<=57){selectInstrument(code-49);}else if(code==48){selectInstrument(9);}else if(code==189){selectInstrument(10)}else if(code==187){selectInstrument(11);}else if(code==32){if(!song.playing)
    song.play(lastPlayTime);else
    song.stop();return false;}}
function onkeypress(event)
{var scaleId=keySelect.selectedIndex==0?1:keySelect.selectedIndex;var scale=settings['scales'][scaleId];var chr=String.fromCharCode(event.keyCode==0?event.which:event.keyCode).toLowerCase();for(var i=0;i<settings['typingKeyboard'].length;i++){var idx=settings['typingKeyboard'][i].indexOf(chr);if(idx!=-1){var n;switch(instrument){case 0:case 4:case 3:case 6:case 7:case 8:case 9:case 10:case 12:n=i+3;break;case 2:case 5:n=i+2;break;case 1:case 11:n=i+4;break;}
    if(idx>settings['scaleOctaves'][scaleId]+7){n+=2;}
    else if(idx>settings['scaleOctaves'][scaleId]){n++;}
    var note=scale[idx]+n;playNote(instrument,note,1);}}};var messageTimeoutId=0;function message(text){if(messageTimeoutId!=0)
    window.clearTimeout(messageTimeoutId);var messageWrapper=document.getElementById('message_wrapper');var messageText=document.getElementById('message_text');messageText.innerHTML=text;messageWrapper.style.display="block";messageTimeoutId=window.setTimeout(function(){messageWrapper.style.display="none";},2000);}
function updateWavesurferWidth(redraw){if(audioSystem.audioTrack!=null){var renderWidth=Math.round(audioSystem.audioTrack.duration/(song.sleepTime/1000)*(noteWidth)/wavesurferScale);var displayWidth=Math.round(renderWidth*wavesurferScale);wavesurfer.style.width=Math.round(renderWidth)+"px"
    if(redraw)
        wavesurferObj.drawBuffer();else if(renderWidth>32767)
        message('Waveform is too long to display. Try zooming out or lowering the BPM.');$('canvas').attr('style','position: absolute; z-index: 1337; width: '+displayWidth+'px !important; height: 32px;');wavesurfer.style.width=displayWidth+"px";}}
function removeAudioTrack(){audioTrackFile.value=null
    audioSystem.removeAudioTrack();hideAudioTrackSelect();$('#wavesurfer_element').hide();}
function showAudioTrackSelect(){audioTrackLink.style.display="none";audioTrackSelect.style.display="block";}
function hideAudioTrackSelect(){audioTrackLink.style.display="block";audioTrackSelect.style.display="none";}
function showCaptcha(){document.getElementById('captcha_frame').src="/captcha.php";document.getElementById('captcha_container').style.display="block";}
function hideCaptcha(){document.getElementById('captcha_frame').src="about:blank";document.getElementById('captcha_container').style.display="none";}
function getErrorMessage(){return'<span style="color:red">Error saving, check your connection and try again. <a href="javascript:prompt(\'Copy and paste this into any program that can save text. Open a blank sequence and hit Ctrl+V (Cmd+V on Mac) to get your song back.\', getCopyString(song.notes, 0));void(0);">Save offline</a></span>';}
function save(doExport){if(song.notes.length>0){document.getElementById('share').style.display="block";document.getElementById('sharelink').innerHTML='Saving...';data=bpm+":";for(var i=0;i<song.notes.length;i++){var note=song.notes[i];data=data+note.toString(0)+";";}
    if(doExport){sendPostRequest('/app/midi.php',{'data':data});}else{$.ajax({type:"POST",url:endpoint+='/save.php',data:'title='+encodeURIComponent(document.getElementById('title').value)+'&basedon='+song.basedon+'&data='+encodeURIComponent(data),success:function(r){if(r&&r.indexOf('http://')>-1){document.getElementById('sharelink').innerHTML=r;}
    else{document.getElementById('sharelink').innerHTML=getErrorMessage();}
        document.getElementById('share').style.display="block";},error:function(r){document.getElementById('sharelink').innerHTML=getErrorMessage();document.getElementById('share').style.display="block";}});}}}
function clearSong(){song.stop();song.playing=false;if(playTimeoutId)
    window.clearTimeout(playTimeoutId);while(song.notes.length>0){song.removeNote(song.notes[0]);}
    song.updateLoopTime();lastPlayTime=0;selectedNotes=[];dragNotes=[];clickedNote=false;scrollLeft=0;targetScrollLeft=0;}
function loadData(data){var parts=data.split(":");bpm=parts[0];var notes=parts[1];if(typeof bpm=='undefined'||bpm=="")
    bpm="110";if(typeof notes=='undefined')
    notes='';if(typeof song!='undefined')
    clearSong();song=new Song(notes);document.getElementById('bpm').value=bpm;song.setBPM(bpm);}